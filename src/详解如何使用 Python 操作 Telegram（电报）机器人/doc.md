## æ¥”å­

Telegramï¼ˆç”µæŠ¥ï¼‰ç›¸ä¿¡å¤§å®¶éƒ½çŸ¥é“ï¼Œå…³äºå®ƒçš„ä»‹ç»å’Œæ³¨å†Œæ–¹å¼è¿™é‡Œå°±è·³è¿‡äº†ï¼Œæˆ‘å‡è®¾ä½ å·²ç»æ³¨å†Œå¥½äº†ã€‚æœ¬ç¯‡æ–‡ç« æ¥èŠä¸€èŠ Telegram æä¾›çš„æœºå™¨äººï¼Œä»¥åŠå¦‚ä½•ç”¨ Python ä¸ºæœºå™¨äººå®ç°å„ç§å„æ ·çš„åŠŸèƒ½ã€‚

## åˆ›å»ºæœºå™¨äºº

é¦–å…ˆæˆ‘ä»¬ä½¿ç”¨æµè§ˆå™¨æ‰“å¼€ https://web.telegram.orgï¼Œç„¶åç”¨æ‰‹æœºä¸Šçš„ APP æ‰«ç ç™»å½•ã€‚

![](./1.png)

ç™»å½•ä¹‹åæœç´¢ BotFatherï¼Œæœºå™¨äººéœ€è¦é€šè¿‡ BotFather æ¥åˆ›å»ºï¼Œå½“ç„¶ BotFather æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªæœºå™¨äººï¼Œä½†å®ƒåŒæ—¶ç®¡ç†ç€å…¶å®ƒçš„æœºå™¨äººã€‚æˆ‘ä»¬ç‚¹å‡» BotFatherï¼Œä¸‹é¢å°†é€šè¿‡å’Œå®ƒèŠå¤©çš„æ–¹å¼æ¥åˆ›å»ºæœºå™¨äººï¼Œè¿‡ç¨‹å¦‚ä¸‹ã€‚

- 1ï¼‰åœ¨é¡µé¢ä¸­è¾“å…¥å‘½ä»¤ /newbot å¹¶å›è½¦ï¼Œç›¸å½“äºç»™ BotFather å‘æŒ‡ä»¤ï¼Œè¡¨ç¤ºè¦åˆ›å»ºæœºå™¨äººã€‚æ³¨ï¼šå‘½ä»¤è¦ä»¥ / å¼€å¤´ã€‚
- 2ï¼‰BotFather æ”¶åˆ°ä¹‹åä¼šå°†æœºå™¨äººåˆ›å»ºå¥½ï¼Œå¹¶æç¤ºæˆ‘ä»¬ç»™æœºå™¨äººèµ·ä¸€ä¸ªåå­—ï¼Œè¿™é‡Œæˆ‘èµ·åä¸ºï¼šå¤æ˜åœ°è§‰ã€‚
- 3ï¼‰å›è½¦ä¹‹åï¼ŒBotFather ä¼šç»§ç»­è®©æˆ‘ä»¬ç»™æœºå™¨äººèµ·ä¸€ä¸ªç”¨æˆ·åï¼Œè¿™ä¸ªç”¨æˆ·åä¼šä½œä¸ºæœºå™¨äººçš„å”¯ä¸€æ ‡è¯†ï¼Œç”¨äºå®šä½å’ŒæŸ¥æ‰¾ã€‚è¿™é‡Œæˆ‘èµ·åä¸º Satori_Koishi_botï¼Œæ³¨ï¼šç”¨æˆ·åå¿…é¡»ä»¥ Bot æˆ– bot ç»“å°¾ã€‚

ä¸‹é¢æ¥å®é™…æ¼”ç¤ºä¸€ä¸‹ã€‚

![](./2.png)

æˆ‘ä»¬ç‚¹å‡» t.me/Satori_Koishi_botï¼Œçœ‹çœ‹ç»“æœå¦‚ä½•ã€‚

![](./3.png)

ç‚¹å‡» t.me/Satori_Koishi_bot ä¹‹åï¼Œå†ç‚¹å‡»å±å¹•ä¸­çš„ startï¼ˆç›¸å½“äºå‘é€äº†ä¸€æ¡ /start æŒ‡ä»¤ï¼‰ï¼Œå°±å¯ä»¥å’Œæœºå™¨äººèŠå¤©äº†ã€‚å› ä¸ºæˆ‘ä»¬è¿˜æ²¡æœ‰ç¼–å†™ä»£ç ï¼Œæ¥ä¸ºæœºå™¨äººæ·»åŠ ç›¸åº”çš„åŠŸèƒ½ï¼Œæ‰€ä»¥ç›®å‰ä¸ä¼šæœ‰ä»»ä½•äº‹æƒ…å‘ç”Ÿã€‚

ç„¶åæˆ‘ä»¬ç»™è‡ªå®šä¹‰çš„æœºå™¨äººæ·»åŠ ä¸€äº›æè¿°ä¿¡æ¯ï¼Œæ˜¾ç„¶è¿™ä¾èµ–äº BotFatherã€‚å‘å…¶å‘é€ /mybots æŒ‡ä»¤ï¼Œä¼šè¿”å›æˆ‘ä»¬åˆ›å»ºçš„æ‰€æœ‰çš„æœºå™¨äººï¼Œå½“ç„¶è¿™é‡Œç›®å‰åªæœ‰ä¸€ä¸ªã€‚

![](./4.png)

æˆ‘ä»¬ç‚¹å‡»å®ƒï¼Œçœ‹çœ‹ç»“æœï¼š

![](./5.png)

é‡Œé¢æä¾›äº†å¾ˆå¤šçš„é€‰é¡¹ï¼Œè¿™é‡Œæˆ‘ä»¬å†ç‚¹å‡» Edit Botï¼Œæ¥ç¼–è¾‘æœºå™¨äººçš„ç›¸å…³ä¿¡æ¯ã€‚

![](./6.png)

ä¸éš¾å‘ç°ï¼Œæˆ‘ä»¬é™¤äº†ç»™å½“å‰æœºå™¨äººä¸€ä¸ªåå­—ä¹‹å¤–ï¼Œå…¶å®ƒçš„ä¿¡æ¯å°±æ²¡æœ‰äº†ï¼Œæ‰€ä»¥ Telegram æä¾›äº†ä¸€ç³»åˆ—æŒ‰é’®ï¼Œä¾›æˆ‘ä»¬è¿›è¡Œç¼–è¾‘ã€‚æ¯”å¦‚æˆ‘ä»¬ç‚¹å‡» Edit Botpicï¼Œç¼–è¾‘å¤´åƒã€‚

![](./7.png)

ç„¶åæœºå™¨äººçš„å¤´åƒä¼šå‘ç”Ÿæ”¹å˜ï¼Œå½“ç„¶è¿™äº›éƒ½å±äºé”¦ä¸Šæ·»èŠ±çš„ä¸œè¥¿ï¼Œæœ€é‡è¦çš„æ˜¯ Edit Commandsï¼Œå®ƒæ˜¯æœºå™¨äººèƒ½å¤Ÿäº§ç”Ÿè¡Œä¸ºçš„æ ¸å¿ƒï¼Œå¦åˆ™å½“å‰çš„æœºå™¨äººå°±æ˜¯ä¸ªç»£èŠ±æ•å¤´ï¼Œä¸­çœ‹ä¸ä¸­ç”¨ã€‚

ä¸‹é¢æˆ‘ä»¬ç‚¹å‡» Edit Commandsï¼Œæ·»åŠ ä¸€ä¸ª /help å‘½ä»¤ã€‚

![](./8.png)

æ·»åŠ æ ¼å¼ä¸º<font color="blue">å‘½ä»¤ - æè¿°</font>ï¼Œå¯åŒæ—¶æ·»åŠ å¤šä¸ªã€‚

![](./9.png)

ç›®å‰æœºå™¨äººä¾¿æ”¯æŒäº† /help å‘½ä»¤ï¼Œå¦å¤–å¦‚æœç‚¹å‡» Edit Command ä¹‹åå†è¾“å…¥ /emptyï¼Œé‚£ä¹ˆä¹Ÿå¯ä»¥å°†æœºå™¨äººç°æœ‰çš„å‘½ä»¤æ¸…ç©ºæ‰ã€‚

è™½ç„¶ /help å‘½ä»¤æœ‰äº†ï¼Œä½†å‘é€è¿™ä¸ªå‘½ä»¤ä¹‹åï¼Œæœºå™¨äººä¸ä¼šæœ‰ä»»ä½•çš„ååº”ï¼Œå› ä¸ºæˆ‘ä»¬è¿˜æ²¡æœ‰ç»™å‘½ä»¤ç»‘å®šç›¸åº”çš„å¤„ç†å‡½æ•°ï¼Œä¸‹é¢å°±æ¥çœ‹çœ‹å¦‚ä½•ç»‘å®šã€‚å½“ç„¶å•¦ï¼Œæœºå™¨äººä¸å…‰è¦å¯¹å‘½ä»¤åšå‡ºååº”ï¼Œå°±ç®—æ˜¯æ™®é€šçš„æ–‡æœ¬ã€è¡¨æƒ…ã€å›¾ç‰‡ç­‰æ¶ˆæ¯ï¼Œä¹Ÿåº”è¯¥åšå‡ºååº”ã€‚è‡³äºå‘½ä»¤æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªçº¯æ–‡æœ¬ï¼Œåªä¸è¿‡å®ƒåº”è¯¥ä»¥ / å¼€å¤´ã€‚

## æ¥æ”¶æ¶ˆæ¯å¹¶å¤„ç†

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Python è¿æ¥ Telegram æœºå™¨äººï¼Œä¸ºå®ƒç»‘å®šå¤„ç†å‡½æ•°ï¼Œé¦–å…ˆéœ€è¦å®‰è£…ä¸€ä¸ªç¬¬ä¸‰æ–¹åº“ã€‚

> pip3 install "python-telegram-bot[all]"

ç„¶åè·å–æœºå™¨äººçš„ Tokenï¼Œè¿™ä¸ª Token æ€ä¹ˆè·å–å‘¢ï¼Ÿ

![](./10.png)

åƒ BotFather å‘é€ /mybots å‘½ä»¤ï¼Œç‚¹å‡»æŒ‡å®šæœºå™¨äººçš„ API Token å³å¯è·å–ã€‚

![](./11.png)

æœ‰äº†è¿™ä¸ª Token ä¹‹åï¼Œå°±å¯ä»¥å’Œæœºå™¨äººå»ºç«‹è¿æ¥äº†ã€‚

~~~python
import asyncio
import telegram
from telegram.request import HTTPXRequest
# ä»£ç†ï¼Œç”±äºä¸æ–¹ä¾¿å±•ç¤ºï¼Œå› æ­¤æˆ‘å®šä¹‰åœ¨äº†ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ä¸­
# è¿™é‡Œçš„ PROXY æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œç±»ä¼¼äº "http://username:password@ip:port"
from proxy import PROXY

BOT_API_TOKEN = "6485526535:AAEvGr9EDqtc4QPehkgohH6gczOTO5RIYRE"

async def main():
    # ä¼ é€’æœºå™¨äººçš„ Tokenï¼Œå†…éƒ¨ä¼šè‡ªåŠ¨å’Œå®ƒå»ºç«‹è¿æ¥
    bot = telegram.Bot(
        BOT_API_TOKEN,
        # æŒ‡å®šä»£ç†
        request=HTTPXRequest(proxy=PROXY),
        get_updates_request=HTTPXRequest(proxy=PROXY),
    )
    async with bot:
        # æµ‹è¯•è¿æ¥æ˜¯å¦æˆåŠŸï¼Œå¦‚æœæˆåŠŸï¼Œä¼šè¿”å›æœºå™¨äººçš„ä¿¡æ¯
        print(await bot.get_me())

asyncio.run(main())
"""
User(api_kwargs={'has_main_web_app': False}, 
     can_connect_to_business=False, 
     can_join_groups=True, 
     can_read_all_group_messages=False, 
     first_name='å¤æ˜åœ°è§‰', 
     id=6485526535, 
     is_bot=True, 
     supports_inline_queries=False, 
     username='Satori_Koishi_bot')
"""
~~~

è¿”å›å€¼åŒ…å«äº†æœºå™¨äººçš„å…·ä½“ä¿¡æ¯ï¼Œè¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œåªéœ€æŒ‡å®šä¸€ä¸ª Token å³å¯è®¿é—®ã€‚å½“ç„¶å•¦ï¼Œç”±äºç½‘ç»œçš„åŸå› è¿˜éœ€è¦ä½¿ç”¨ä»£ç†ã€‚

ç„¶åé€šè¿‡è¯¥æ¨¡å—è¿˜å¯ä»¥ç»™æœºå™¨äººå‘æ¶ˆæ¯ï¼Œä½†è¿™æ˜¾ç„¶ä¸æ˜¯æˆ‘ä»¬çš„é‡ç‚¹ï¼Œå› ä¸ºæ¶ˆæ¯è‚¯å®šæ˜¯é€šè¿‡ APP æˆ–è€…æµè§ˆå™¨å‘é€çš„ã€‚æˆ‘ä»¬è¦åšçš„æ˜¯ï¼Œå®šä¹‰æœºå™¨äººçš„å›å¤é€»è¾‘ï¼Œå½“ç”¨æˆ·ç»™å®ƒå‘æ¶ˆæ¯æ—¶ï¼Œå®ƒåº”è¯¥åšäº›ä»€ä¹ˆäº‹æƒ…ã€‚

å…ˆæ¥ä¸€ä¸ªç®€å•çš„æ¡ˆä¾‹ï¼Œå½“ç”¨æˆ·è¾“å…¥ /start å‘½ä»¤æ—¶ï¼Œå›å¤ä¸€æ®µæ–‡æœ¬ã€‚

~~~python
from telegram import Update
from telegram.ext import ApplicationBuilder, ContextTypes, CommandHandler
from proxy import PROXY

BOT_API_TOKEN = "6485526535:AAEvGr9EDqtc4QPehkgohH6gczOTO5RIYRE"

# å®šä¹‰ä¸€ä¸ªå¤„ç†å‡½æ•°
# update å°è£…äº†ç”¨æˆ·å‘é€çš„æ¶ˆæ¯æ•°æ®
# context åˆ™å°è£…äº† Bot å¯¹è±¡å’Œä¸€äº›ä¼šè¯æ•°æ®
# è¿™ä¸¤ä¸ªå¯¹è±¡éå¸¸é‡è¦ï¼Œåé¢è¿˜ä¼šè¯¦ç»†è¯´
async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    # context.bot ä¾¿æ˜¯æœºå™¨äººï¼Œå¯ä»¥è°ƒç”¨å®ƒçš„ send_message æ–¹æ³•å›å¤æ¶ˆæ¯
    await context.bot.send_message(
        # å…³äº chat_id ç¨åè§£é‡Š
        chat_id=update.message.chat.id,
        # å›å¤çš„æ–‡æœ¬å†…å®¹
        text="æ¬¢è¿æ¥åˆ°åœ°çµæ®¿"
    )

# æ„å»ºä¸€ä¸ªåº”ç”¨
application = ApplicationBuilder().token(BOT_API_TOKEN).proxy(PROXY).build()
# åˆ›å»ºä¸€ä¸ª CommandHandler å®ä¾‹ï¼Œå½“ç”¨æˆ·è¾“å…¥ /start çš„æ—¶å€™ï¼Œæ‰§è¡Œ start å‡½æ•°
start_handler = CommandHandler("start", start)
# å°† start_handler åŠ åˆ°åº”ç”¨å½“ä¸­
application.add_handler(start_handler)
# å¼€å¯æ— é™å¾ªç¯ï¼Œç›‘å¬äº‹ä»¶
application.run_polling()
~~~

æˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹ï¼š

![](./12.png)

æ˜¾ç„¶ç»“æœæ˜¯æˆåŠŸçš„ï¼Œä¸è¿‡ç›®å‰è¿™ä¸ªæœºå™¨äººåªèƒ½å¤„ç† /start å‘½ä»¤ï¼Œå¦‚æœå¸Œæœ›å®ƒæ”¯æŒæ›´å¤šçš„å‘½ä»¤ï¼Œé‚£ä¹ˆå°±å®šä¹‰å¤šä¸ª CommandHandler å³å¯ã€‚ä½†æ˜¯é—®é¢˜æ¥äº†ï¼Œå¦‚æœæˆ‘ä»¬å¸Œæœ›è¿™ä¸ªæœºå™¨äººèƒ½å¤„ç†æ™®é€šæ–‡æœ¬çš„è¯ï¼Œè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ

```python
from telegram import Update
from telegram.ext import (
    ApplicationBuilder, ContextTypes,
    MessageHandler, filters
)
from proxy import PROXY

BOT_API_TOKEN = "6485526535:AAEvGr9EDqtc4QPehkgohH6gczOTO5RIYRE"

async def reply(update: Update, context: ContextTypes.DEFAULT_TYPE):
    await context.bot.send_message(
        chat_id=update.message.chat.id,
        # é€šè¿‡ update.message.text å¯ä»¥æ‹¿åˆ°ç”¨æˆ·å‘é€çš„æ¶ˆæ¯
        text=f"å¤æ˜åœ°è§‰å·²æ”¶åˆ°ï¼Œä½ å‘çš„å†…å®¹æ˜¯ï¼š{update.message.text}"
    )

application = ApplicationBuilder().token(BOT_API_TOKEN).proxy(PROXY).build()
# å‰é¢ä½¿ç”¨äº† CommandHandlerï¼Œå®ƒä¸“é—¨ç”¨æ¥å¤„ç†å‘½ä»¤ï¼Œç¬¬ä¸€ä¸ªå‚æ•°åº”è¯¥æ˜¯å­—ç¬¦ä¸²
# æ¯”å¦‚ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ "start"ï¼Œé‚£ä¹ˆå°±ç»™æœºå™¨äººå¢åŠ äº†ä¸€ä¸ªå›å¤ /start å‘½ä»¤çš„åŠŸèƒ½
# è€Œ MessageHandler å¯ä»¥ç”¨äºå›å¤æ‰€æœ‰ç±»å‹çš„æ¶ˆæ¯ï¼Œæ¯”å¦‚æ–‡æœ¬ã€è¡¨æƒ…ã€å›¾ç‰‡ã€è§†é¢‘ç­‰ç­‰
# å…·ä½“èƒ½å›å¤å“ªäº›ï¼Œé€šè¿‡ç¬¬ä¸€ä¸ªå‚æ•°æŒ‡å®šã€‚è¿™é‡Œè¡¨ç¤ºåªè¦ç”¨æˆ·å‘é€äº†æ–‡æœ¬æ¶ˆæ¯ï¼Œå°±æ‰§è¡Œ reply å‡½æ•°
reply_handler = MessageHandler(filters.TEXT, reply)
application.add_handler(reply_handler)
application.run_polling()
```

æµ‹è¯•ä¸€ä¸‹ï¼š

![](./13.png)

ç»“æœæ²¡æœ‰é—®é¢˜ï¼Œå¹¶ä¸” /start å‘½ä»¤ä¹Ÿè¢«å½“æˆæ™®é€šçš„æ–‡æœ¬å¤„ç†äº†ï¼Œå› ä¸ºå‘½ä»¤æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªæ–‡æœ¬ã€‚ç„¶åä»£ç ä¸­çš„ filtersï¼Œå®ƒé‡Œé¢é™¤äº†æœ‰è¡¨ç¤ºæ–‡æœ¬ç±»å‹çš„ TEXTï¼Œè¿˜æœ‰å¾ˆå¤šå…¶å®ƒç±»å‹ã€‚

~~~python
# å‘½ä»¤
filters.COMMAND
# æ™®é€šæ–‡æœ¬ï¼ˆåŒ…æ‹¬ emojiï¼‰
filters.TEXT
# Telegram è´´çº¸åŒ…ä¸­çš„è´´çº¸
filters.Sticker.ALL
# å›¾ç‰‡æ–‡ä»¶
filters.PHOTO
# éŸ³é¢‘æ–‡ä»¶
filters.AUDIO
# è§†é¢‘æ–‡ä»¶
filters.VIDEO
# æ–‡æ¡£ï¼ˆä¾‹å¦‚ PDFã€DOCX ç­‰ç­‰ï¼‰
filters.Document.ALL
# è¯­éŸ³ï¼ˆä½¿ç”¨ Telegram å½•åˆ¶çš„è¯­éŸ³ï¼‰
filters.VOICE
# åœ°ç†ä½ç½®
filters.LOCATION
# è”ç³»äºº
filters.CONTACT
# åŠ¨ç”»ï¼Œé€šå¸¸æ˜¯ GIF
filters.ANIMATION
# é€šè¿‡ Telegram çš„è§†é¢‘ç¬”è®°åŠŸèƒ½å½•åˆ¶çš„è§†é¢‘
filters.VIDEO_NOTE

# å¦‚æœå¸Œæœ›åŒæ—¶æ”¯æŒå¤šç§ç±»å‹ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ | è¿›è¡Œè¿æ¥
# æ¯”å¦‚åŒæ—¶æ”¯æŒ "æ–‡æœ¬" å’Œ "å›¾ç‰‡"
filters.TEXT | filters.PHOTO
# å½“ç„¶ä¹Ÿå¯ä»¥å–åï¼Œ~filters.TEXT è¡¨ç¤ºé™¤äº†æ–‡æœ¬ä»¥å¤–çš„ç±»å‹
~filters.TEXT
# | å’Œ ~ éƒ½å‡ºç°äº†ï¼Œæ˜¾ç„¶è¿˜å‰©ä¸‹ &ï¼Œè€Œ & ä¹Ÿæ˜¯æ”¯æŒçš„ 
# æˆ‘ä»¬çŸ¥é“å‘½ä»¤æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªä»¥ / å¼€å¤´çš„æ–‡æœ¬
# å¦‚æœæˆ‘ä»¬å¸Œæœ›åªå¤„ç†æ™®é€šæ–‡æœ¬ï¼Œä¸å¤„ç†å‘½ä»¤ï¼Œè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ
# å¾ˆç®€å•ï¼Œåƒä¸‹é¢è¿™æ ·æŒ‡å®šå³å¯ï¼Œæ­¤æ—¶ä»¥ / å¼€å¤´çš„æ–‡æœ¬ï¼ˆå‘½ä»¤ï¼‰ä¼šè¢«å¿½ç•¥æ‰
filters.TEXT & ~filters.COMMAND

# é™¤äº†ä»¥ä¸Šè¿™äº›ï¼Œfilters è¿˜æ”¯æŒå…¶å®ƒç±»å‹ï¼Œæœ‰å…´è¶£å¯ä»¥çœ‹ä¸€ä¸‹
# å½“ç„¶ filters è¿˜æä¾›äº†ä¸€ä¸ª ALLï¼Œè¡¨ç¤ºæ‰€æœ‰ç±»å‹
filters.ALL
~~~

ç„¶åæ³¨æ„ä¸€ä¸‹é‡Œé¢çš„ filters.Sticker å’Œ filters.Documentï¼Œè¿™ä¸¤ä¸ªç±»å‹æ¯”è¾ƒç‰¹æ®Šï¼Œå®ƒä»¬å†…éƒ¨è¿˜å¯ä»¥ç»†åˆ†ï¼Œè¿™é‡Œæˆ‘ä»¬å°±ä¸ç»†åˆ†äº†ï¼Œç›´æ¥ .ALL å³å¯ã€‚æˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹ï¼Œçœ‹çœ‹è¿™äº›ç±»å‹æ¶ˆæ¯éƒ½é•¿ä»€ä¹ˆæ ·å­ã€‚

~~~python
from telegram import Update
from telegram.ext import (
    ApplicationBuilder, ContextTypes,
    MessageHandler, filters
)
from proxy import PROXY

BOT_API_TOKEN = "6485526535:AAEvGr9EDqtc4QPehkgohH6gczOTO5RIYRE"

async def get_message_type(update: Update, context: ContextTypes.DEFAULT_TYPE):
    # è·å–æ¶ˆæ¯
    message = update.message
    # è·å–æ¶ˆæ¯ç±»å‹
    if message.text:
        if message.text[0] == "/":
            message_type = "filters.COMMAND"
        else:
            message_type = "filters.TEXT"
    elif message.sticker:
        message_type = "filters.Sticker"
    elif message.photo:
        message_type = "filters.PHOTO"
    elif message.audio:
        message_type = "filters.AUDIO"
    elif message.video:
        message_type = "filters.VIDEO"
    elif message.document:
        message_type = "filters.Document"
    elif message.voice:
        message_type = "filters.VOICE"
    elif message.location:
        message_type = "filters.LOCATION"
    elif message.contact:
        message_type = "filters.CONTACT"
    elif message.animation:
        message_type = "filters.ANIMATION"
    elif message.video_note:
        message_type = "filters.VIDEO_NOTE"
    else:
        message_type = "filters.<OTHER TYPE>"
    await context.bot.send_message(
        chat_id=update.message.chat.id,
        text=f"ä½ å‘é€çš„æ¶ˆæ¯çš„ç±»å‹æ˜¯ {message_type}"
    )

application = ApplicationBuilder().token(BOT_API_TOKEN).proxy(PROXY).build()
reply_handler = MessageHandler(filters.ALL, get_message_type)
application.add_handler(reply_handler)
application.run_polling()
~~~

æˆ‘ä»¬å‘å‡ æ¡æ¶ˆæ¯ï¼Œè®©æœºå™¨äººå‘Šè¯‰æˆ‘ä»¬æ¶ˆæ¯çš„ç±»å‹ã€‚

![](./14.png)

è‡³äºå…¶å®ƒç±»å‹ï¼Œæ„Ÿå…´è¶£å¯ä»¥æµ‹è¯•ä¸€ä¸‹ã€‚

## update å’Œ context

å¤„ç†å‡½æ•°é‡Œé¢æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯ update å’Œ contextã€‚å®ƒä»¬éå¸¸é‡è¦ï¼Œæˆ‘ä»¬æ¥æ‰“å°ä¸€ä¸‹ï¼Œçœ‹çœ‹é•¿ä»€ä¹ˆæ ·å­ã€‚

```python
async def reply(update: Update, context: ContextTypes.DEFAULT_TYPE):
    pprint(update.to_dict())
    await context.bot.send_message(chat_id=update.message.chat.id,
                                   text="ä¸æƒ³è¯´è¯")

application = ApplicationBuilder().token(BOT_API_TOKEN).proxy(PROXY).build()
reply_handler = MessageHandler(filters.ALL, reply)
application.add_handler(reply_handler)
application.run_polling()
```

ä¸‹é¢å‘é€ä¸€æ¡æ–‡æœ¬æ¶ˆæ¯ã€‚

![](./15.png)

ç„¶åæŸ¥çœ‹ update.to_dict() çš„è¾“å‡ºæ˜¯ä»€ä¹ˆï¼Œä¸ºäº†æ–¹ä¾¿ç†è§£ï¼Œæˆ‘å°†å­—æ®µé¡ºåºè°ƒæ•´äº†ä¸€ä¸‹ã€‚

~~~python
{
    'message': {
        # æ˜¯å¦åˆ›å»ºäº†é¢‘é“ï¼Œå› ä¸ºæ˜¯ç§èŠï¼Œæ‰€ä»¥ä¸º False
        'channel_chat_created': False,
        # èŠå¤©ç…§ç‰‡æ˜¯å¦å·²è¢«åˆ é™¤ï¼Œç§èŠä¸€èˆ¬ä¹Ÿä¸º False
        'delete_chat_photo': False,
        # æ˜¯å¦åˆ›å»ºäº†ç¾¤ç»„ï¼Œå› ä¸ºæ˜¯ç§èŠï¼Œæ‰€ä»¥ä¸º False
        'group_chat_created': False,
        # æ˜¯å¦åˆ›å»ºäº†è¶…çº§ç¾¤ç»„ï¼Œå› ä¸ºæ˜¯ç§èŠï¼Œæ‰€ä»¥ä¸º False
        'supergroup_chat_created': False,
        # "å‘é€è€…" å‘é€çš„æ¶ˆæ¯
        # å› ä¸ºå‘é€çš„æ˜¯æ–‡æœ¬ï¼Œæ‰€ä»¥è¿™é‡Œæ˜¯ text å­—æ®µ
        'text': 'è¿™æ˜¯ä¸€æ¡æ–‡æœ¬æ¶ˆæ¯',
        # æ¶ˆæ¯å‘é€çš„æ—¶é—´
        'date': 1722623118,
        # æ¶ˆæ¯çš„ ID
        'message_id': 84,
        # æ¶ˆæ¯å‘é€è€…çš„ä¿¡æ¯
        'from': {
            'first_name': 'å°äº‘',
            'id': 6353481551,
            'is_bot': False,
            'language_code': 'zh-hans',
            'last_name': 'åŒå­¦'
        },
        # chat è¡¨ç¤ºä¼šè¯ç¯å¢ƒï¼Œæœºå™¨äººè¦é€šè¿‡ chat åˆ¤æ–­æ¶ˆæ¯åº”è¯¥å›å¤ç»™è°
        # å› ä¸ºç›®å‰æ˜¯å’Œæœºå™¨äººç§èŠï¼Œæ‰€ä»¥æœºå™¨äººçš„å›å¤å¯¹è±¡å°±æ˜¯æ¶ˆæ¯çš„å‘é€è€…
        # å› æ­¤é‡Œé¢çš„ first_nameã€last_nameã€id å’Œæ¶ˆæ¯å‘é€è€…æ˜¯ä¸€è‡´çš„
        # ä½†å¦‚æœæ˜¯ç¾¤èŠï¼Œé‚£ä¹ˆé‡Œé¢çš„ id å­—æ®µåˆ™è¡¨ç¤ºç¾¤ç»„çš„ id
        # æ­¤å¤–è¿˜ä¼šåŒ…å«ä¸€ä¸ª title å­—æ®µï¼Œè¡¨ç¤ºç¾¤ç»„çš„åç§°
        'chat': {
            'first_name': 'å°äº‘',
            'last_name': 'åŒå­¦',
            # ä¸ç®¡ chat çš„ç±»å‹æ˜¯ä»€ä¹ˆï¼Œé‡Œé¢ä¸€å®šä¼šåŒ…å« id å­—æ®µ
            # è¿™ä¸ª id å¯èƒ½æ˜¯ç”¨æˆ·çš„ idï¼Œä¹Ÿå¯èƒ½æ˜¯ç¾¤ç»„çš„ id
            # æ€»ä¹‹æœ‰äº†è¿™ä¸ª idï¼Œæœºå™¨äººå°±çŸ¥é“è¦å°†æ¶ˆæ¯å›å¤ç»™è°
            # æ‰€ä»¥ä»£ç ä¸­çš„ send_message æ–¹æ³•è‡³å°‘è¦åŒ…å«ä¸¤ä¸ªå‚æ•°
            # åˆ†åˆ«æ˜¯ chat_idï¼ˆå‘é€ç»™è°ï¼‰å’Œ textï¼ˆå‘é€çš„å†…å®¹ï¼‰
            'id': 6353481551,
            # chat çš„ç±»å‹ï¼Œå®šä¹‰åœ¨ filters.ChatType ä¸­
            # ChatType.PRIVATEï¼šç§äººå¯¹è¯
            # ChatType.GROUPï¼šæ™®é€šç¾¤ç»„èŠå¤©
            # ChatType.SUPERGROUPï¼šè¶…çº§ç¾¤ç»„èŠå¤©
            # ChatType.GROUPSï¼šæ™®é€šç¾¤ç»„èŠå¤©æˆ–è¶…çº§ç¾¤ç»„èŠå¤©
            # ChatType.CHANNELï¼šé¢‘é“ï¼Œç”¨äºå‘è®¢é˜…è€…å¹¿æ’­æ¶ˆæ¯
            'type': '<ChatType.PRIVATE>'
        },
    },
    # æ¯å‘é€ä¸€æ¡æ¶ˆæ¯ï¼Œä¼šè¯éƒ½åœ¨æ›´æ–°ï¼Œæ‰€ä»¥ update_id è¡¨ç¤ºæ›´æ–°çš„å”¯ä¸€æ ‡è¯†ç¬¦
    # ç”¨äºè·Ÿè¸ªæ›´æ–°ï¼Œä»¥ç¡®ä¿æ¶ˆæ¯å¤„ç†æ²¡æœ‰ä¸¢å¤±æˆ–é‡å¤
    'update_id': 296857735
}
~~~

ä»¥ä¸Šå°±æ˜¯ update.to_dict() çš„è¾“å‡ºç»“æœï¼Œå½“ç”¨æˆ·å‘ bot å‘é€æ¶ˆæ¯æ—¶ï¼ŒTelegram æœåŠ¡å™¨ä¼šå°†è¿™äº›æ•°æ®ä»¥ JSON çš„å½¢å¼å‘é€ç»™å½“å‰çš„åº”ç”¨ç¨‹åºï¼Œä»¥ä¾¿ bot å¯ä»¥å¤„ç†å’Œå“åº”è¿™äº›æ¶ˆæ¯ã€‚å½“ç„¶å•¦ï¼Œæˆ‘ä»¬è¿™é‡Œä½¿ç”¨çš„åº“ä¼šå°†æ•°æ®å°è£…æˆ Update å¯¹è±¡ï¼Œå› æ­¤è·å–æ•°æ®æ—¶ï¼Œå¯ä»¥æœ‰ä»¥ä¸‹ä¸¤ç§è·å–æ–¹å¼ã€‚

~~~python
chat_id = update.to_dict()["message"]["chat"]["id"]
chat_id = update.message.chat.id
~~~

ä»¥ä¸Šæ˜¯å½“ç”¨æˆ·å‘é€æ–‡æœ¬æ¶ˆæ¯æ—¶ï¼ŒTelegram å‘é€çš„æ•°æ®ï¼Œæˆ‘ä»¬å†è¯•ä¸€ä¸‹å…¶å®ƒçš„ï¼Œæ¯”å¦‚ä¸Šä¼ ä¸€ä¸ªæ–‡æ¡£ã€‚

```python
{
    'message': {
        'channel_chat_created': False,
        'delete_chat_photo': False,
        'group_chat_created': False,
        'supergroup_chat_created': False,
        'chat': {'first_name': 'å°äº‘',
                 'id': 6353481551,
                 'last_name': 'åŒå­¦',
                 'type': '<ChatType.PRIVATE>'},
        'date': 1722628661,
        # å› ä¸ºå‘é€çš„æ˜¯æ–‡æ¡£ï¼Œæ‰€ä»¥è¿™é‡Œæ˜¯ document å­—æ®µ
        'document': {'file_id': 'BQACAgUAAxkBAANgZq06NVL6......',
                     'file_name': 'OpenAI.pdf',
                     'file_size': 2279632,
                     'file_unique_id': 'AgADLw8AAn36cFU',
                     'mime_type': 'application/pdf',
                     'thumb': {
                         'file_id': 'AAMCBQADGQEAA2BmrTo1Uv......',
                         'file_size': 22533,
                         'file_unique_id': 'AQADLw8AAn36cFVy',
                         'height': 320,
                         'width': 243},
                     'thumbnail': {
                         'file_id': 'AAMCBQADGQEAA2BmrTo1U......',
                         'file_size': 22533,
                         'file_unique_id': 'AQADLw8AAn36cFVy',
                         'height': 320,
                         'width': 243}},
        'from': {'first_name': 'å°äº‘',
                 'id': 6353481551,
                 'is_bot': False,
                 'language_code': 'zh-hans',
                 'last_name': 'åŒå­¦'},
        'message_id': 96,
    },
    'update_id': 296857741
}
```

è‡³äºå…¶å®ƒçš„ç±»å‹ä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼Œå¯ä»¥è‡ªå·±è¯•ä¸€ä¸‹ï¼Œæ¯”å¦‚ä¸Šä¼ ä¸€æ®µè§†é¢‘ï¼Œçœ‹çœ‹æ‰“å°çš„è¾“å‡ºæ˜¯ä»€ä¹ˆã€‚

ä¸è¿‡è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯å½“ç”¨æˆ·ä¸Šä¼ éŸ³é¢‘ã€è§†é¢‘ã€æ–‡æ¡£ç­‰ï¼Œbot å¦‚ä½•è·å–å®ƒä»¬å‘¢ï¼Ÿæ˜¾ç„¶è¦ä¾èµ–é‡Œé¢çš„ file_idã€‚

```python
async def download(update: Update, context: ContextTypes.DEFAULT_TYPE):
    document = update.message.document

    file_id = document.file_id  # æ–‡ä»¶ id
    file_size = document.file_size  # æ–‡ä»¶å¤§å°
    file_name = document.file_name  # æ–‡ä»¶å
    # ç”¨æˆ·ä¸Šä¼ çš„æ–‡ä»¶ä¼šä¿å­˜åœ¨ Telegram æœåŠ¡å™¨ï¼Œæˆ‘ä»¬å¯ä»¥åŸºäºæ–‡ä»¶ id è·å–
    file_obj = await context.bot.get_file(file_id)
    # file_obj.file_path ä¾¿æ˜¯æ–‡ä»¶çš„åœ°å€ï¼Œç›´æ¥ä¸‹è½½å³å¯
    with open(file_name, "wb") as f:
        resp = httpx.get(file_obj.file_path, proxy=PROXY)
        f.write(resp.content)
    await context.bot.send_message(
        chat_id=update.message.chat.id,
        text=f"{file_name} ä¸‹è½½å®Œæ¯•ï¼Œå¤§å° {file_size} å­—èŠ‚"
    )

application = ApplicationBuilder().token(BOT_API_TOKEN).proxy(PROXY).build()
download_handler = MessageHandler(filters.Document.ALL, download)
application.add_handler(download_handler)
application.run_polling()
```

æˆ‘ä»¬ä¸Šä¼ å‡ ä¸ªæ–‡ä»¶è¯•è¯•ã€‚

![](./16.png)

ç»“æœæ²¡æœ‰é—®é¢˜ï¼Œç”¨æˆ·ä¸Šä¼ çš„æ–‡ä»¶ä¹Ÿä¸‹è½½åˆ°äº†æœ¬åœ°ã€‚

## å›å¤å¯Œæ–‡æœ¬æ¶ˆæ¯

ç›®å‰æœºå™¨äººå›å¤çš„éƒ½æ˜¯æ™®é€šçš„çº¯æ–‡æœ¬ï¼Œä½†ä¹Ÿå¯ä»¥å›å¤å¯Œæ–‡æœ¬æ¶ˆæ¯ã€‚

```python
async def rich_msg(update: Update, context: ContextTypes.DEFAULT_TYPE):
    message = update.message
    if message.text == "baidu":
        text = '<a href="https://www.baidu.com">ç‚¹å‡»è¿›å…¥ç™¾åº¦é¡µé¢</a>'
    elif message.text == "zhihu":
        text = '<a href="https://www.zhihu.com">ç‚¹å‡»è¿›å…¥çŸ¥ä¹é¡µé¢</a>'
    elif message.text == "bilibili":
        text = '<a href="https://www.bilibili.com">ç‚¹å‡»è¿›å…¥ B ç«™é¡µé¢</a>'
    else:
        text = 'Unsupported Website'
    await context.bot.send_message(
        chat_id=update.message.chat.id,
        text=text,
        # æŒ‰ç…§ HTML è¿›è¡Œè§£æ
        parse_mode="HTML"
    )
```

æµ‹è¯•ä¸€ä¸‹ï¼š

![](./17.png)

ç»“æœæ²¡æœ‰é—®é¢˜ï¼Œå¦å¤–æˆ‘ä»¬çœ‹åˆ° a æ ‡ç­¾è‡ªå¸¦é¢„è§ˆåŠŸèƒ½ï¼Œå¦‚æœä¸å¸Œæœ›é¢„è§ˆï¼Œé‚£ä¹ˆä¹Ÿå¯ä»¥ç¦ç”¨æ‰ã€‚

![](./18.png)

å°† disable_web_page_preview å‚æ•°æŒ‡å®šä¸º Falseï¼Œå³å¯ç¦ç”¨ a æ ‡ç­¾çš„é¢„è§ˆåŠŸèƒ½ã€‚å¦å¤–å‘é€çš„æ¶ˆæ¯é™¤äº†å¯ä»¥æŒ‰ç…§ HTML æ ¼å¼è§£æï¼Œè¿˜å¯ä»¥æŒ‰ç…§ Markdown æ ¼å¼è§£æï¼Œå°† parse_mode å‚æ•°æŒ‡å®šä¸º "Markdown" æˆ–è€… "MarkdownV2" å³å¯ã€‚

## å›å¤å…¶å®ƒç±»å‹çš„æ¶ˆæ¯

ç›®å‰æœºå™¨äººå›å¤çš„éƒ½æ˜¯æ–‡æœ¬ï¼Œé‚£ä¹ˆèƒ½ä¸èƒ½å›å¤éŸ³é¢‘ã€è§†é¢‘ã€å›¾ç‰‡å‘¢ï¼Ÿæ˜¾ç„¶æ˜¯å¯ä»¥çš„ï¼Œå¹¶ä¸”å®ƒä»¬è¿˜å¯ä»¥å’Œæ–‡æœ¬ä¸€èµ·è¿”å›ã€‚

~~~python
# å‘é€å›¾ç‰‡
await context.bot.send_photo(
    chat_id=update.message.chat.id,
    # å¯ä»¥æ˜¯è·¯å¾„ã€å¥æŸ„ã€bytes å¯¹è±¡
    # å·²ç»ä¸Šä¼ åˆ° Telegram æœåŠ¡å™¨çš„æ–‡ä»¶ä¼šæœ‰ä¸€ä¸ª file_id
    # æŒ‡å®š file_id ä¹Ÿæ˜¯å¯ä»¥çš„
    photo="path/to/image.jpg",
)

# å‘é€éŸ³é¢‘
await context.bot.send_audio(
    chat_id=update.message.chat.id,
    # å¯ä»¥æ˜¯ è·¯å¾„ã€å¥æŸ„ã€bytes å¯¹è±¡ã€file_id
    audio="path/to/audio.mp3"
)

# å‘é€è§†é¢‘
await context.bot.send_video(
    chat_id=update.message.chat.id,
    # å¯ä»¥æ˜¯ è·¯å¾„ã€å¥æŸ„ã€bytes å¯¹è±¡ã€file_id
    video="path/to/video.mp4"
)

# å‘é€æ–‡æ¡£
await context.bot.send_document(
    chat_id=update.message.chat.id,
    # å¯ä»¥æ˜¯ è·¯å¾„ã€å¥æŸ„ã€bytes å¯¹è±¡ã€file_id
    document="path/to/document.pdf"
)

# å‘é€è¯­éŸ³
await context.bot.send_voice(
    chat_id=update.message.chat.id,
    # å¯ä»¥æ˜¯ è·¯å¾„ã€å¥æŸ„ã€bytes å¯¹è±¡ã€file_id
    voice=r"path/to/voice.ogg",
)

# å‘é€ä½ç½®
await context.bot.send_location(
    chat_id=update.message.chat.id,
    latitude=40.4750280, longitude=116.2676535
)

# å‘é€è”ç³»äºº
from telegram import Contact
contact = Contact(
    phone_number='+8618510286802',
    first_name='èŠ™å…°æœµéœ²',
    # ä»¥ä¸‹ä¸¤ä¸ªå‚æ•°ä¹Ÿå¯ä»¥ä¸æŒ‡å®š
    last_name='æ–¯å¡é›·ç‰¹',
    user_id=5783657687
)
await context.bot.send_contact(
    chat_id=update.message.chat.id,
    contact=contact
)

# å‘é€è´´çº¸
await context.bot.send_sticker(
    chat_id=update.message.chat.id,
    # å¯ä»¥æ˜¯ è·¯å¾„ã€å¥æŸ„ã€bytes å¯¹è±¡ã€file_id
    sticker="CAACAgIAAxkBAAO5Zq5kRNKkIGZpH......"
)

# å‘é€ GIF
await context.bot.send_animation(
    chat_id=update.message.chat.id,
    # å¯ä»¥æ˜¯ è·¯å¾„ã€å¥æŸ„ã€bytes å¯¹è±¡ã€file_id
    animation="CgACAgIAAxkBAAPBZq5lekVT95I......"
)
~~~

é™¤äº†ä»¥ä¸Šè¿™äº›ï¼Œè¿˜å¯ä»¥å‘é€å…¶å®ƒç±»å‹çš„æ¶ˆæ¯ï¼Œä¸è¿‡ä¸å¸¸ç”¨ï¼Œæœ‰å…´è¶£çš„è¯å¯ä»¥è‡ªå·±çœ‹ä¸€ä¸‹ï¼Œè¿™äº›æ–¹æ³•éƒ½ä»¥ send_ å¼€å¤´ã€‚ç„¶åæˆ‘ä»¬æ¥å‘å‡ æ¡æ¶ˆæ¯ï¼Œæµ‹è¯•ä¸€ä¸‹ã€‚

![](./19.png)

ç»“æœæ²¡æœ‰é—®é¢˜ã€‚

## åª’ä½“ç»„

ç°åœ¨æˆ‘ä»¬å·²ç»çŸ¥é“å¦‚ä½•è®©æœºå™¨äººå›å¤ä¸åŒç§ç±»çš„æ¶ˆæ¯äº†ï¼Œä½†å¦‚æœæˆ‘æƒ³å®ç°æ›´å¤æ‚çš„åŠŸèƒ½ï¼Œæ¯”å¦‚åŒæ—¶å‘é€å¤šå¼ å›¾ç‰‡ã€å¤šä¸ªè§†é¢‘ï¼Œå¹¶ä¸”è¿˜é…å¸¦æ–‡å­—ï¼Œè¦æ€ä¹ˆåšå‘¢ï¼Ÿå¯èƒ½æœ‰äººè§‰å¾—è¿™è¿˜ä¸ç®€å•ï¼Œå†™ä¸ªå¾ªç¯ä¸å°±è¡Œäº†ï¼Œæ¯”å¦‚è¦å‘é€ 5 ä¸ªè§†é¢‘ï¼Œé‚£ä¹ˆè°ƒç”¨ 5 æ¬¡ send_video æ–¹æ³•ä¸å°±å¥½äº†ã€‚

é¦–å…ˆè¿™æ˜¯ä¸€ç§æ–¹æ³•ï¼Œä½†å¾ªç¯ 5 æ¬¡ï¼Œé‚£ä¹ˆè¿™ 5 ä¸ªè§†é¢‘æ˜¯ä½œä¸ºä¸åŒçš„æ¶ˆæ¯åˆ†å¼€å‘é€çš„ã€‚æ›´å¤šæ—¶å€™ï¼Œæˆ‘ä»¬æ˜¯å¸Œæœ›ä½œä¸ºä¸€ä¸ªæ•´ä½“å‘é€ï¼Œé‚£ä¹ˆæ­¤æ—¶å¯ä»¥ä½¿ç”¨åª’ä½“ç»„åŠŸèƒ½ã€‚

```python
from telegram import Update, InputMediaPhoto
from telegram.ext import (
    ApplicationBuilder,
    ContextTypes,
    CommandHandler
)
from proxy import PROXY

BOT_API_TOKEN = "6485526535:AAEvGr9EDqtc4QPehkgohH6gczOTO5RIYRE"

async def send_media_group(update: Update,
                           context: ContextTypes.DEFAULT_TYPE):
    media_group = [
        # å¯ä»¥æ˜¯ URLã€bytes å¯¹è±¡ã€æ–‡ä»¶å¥æŸ„ã€file_id
        InputMediaPhoto(open('satori1.png', "rb"), caption="å¤"),
        InputMediaPhoto(open('satori2.png', "rb"), caption="æ˜"),
        InputMediaPhoto(open('satori3.png', "rb"), caption="åœ°"),
        InputMediaPhoto(open('satori4.png', "rb"), caption="è§‰")
    ]

    # å‘é€åª’ä½“ç»„
    await context.bot.send_media_group(
        chat_id=update.message.chat.id,
        media=media_group
    )

application = ApplicationBuilder().token(BOT_API_TOKEN).proxy(PROXY).build()
download_handler = CommandHandler("satori", send_media_group)
application.add_handler(download_handler)
application.run_polling()
```

æˆ‘ä»¬è¾“å…¥å‘½ä»¤ /satoriï¼Œåº”è¯¥ä¼šè¿”å› 4 å¼ å›¾ç‰‡ã€‚

![](./20.png)

ç»“æœæ²¡æœ‰é—®é¢˜ï¼Œå¹¶ä¸”è¿™ 4 å¼ å›¾ç‰‡æ˜¯æ•´ä½“ä½œä¸ºä¸€æ¡æ¶ˆæ¯å‘é€çš„ã€‚ç„¶åæˆ‘ä»¬åœ¨ä»£ç ä¸­è¿˜æŒ‡å®šäº†ä¸€ä¸ª caption å‚æ•°ï¼Œå®ƒæ˜¯åšä»€ä¹ˆçš„å‘¢ï¼Ÿæˆ‘ä»¬ç‚¹å‡»ä¸€ä¸‹å›¾ç‰‡å°±çŸ¥é“äº†ã€‚

![](./21.png)

ç‚¹å‡»å›¾ç‰‡æ”¾å¤§æŸ¥çœ‹æ—¶ï¼Œcaptaion ä¼šæ˜¾ç¤ºåœ¨å›¾ç‰‡ä¸‹æ–¹ã€‚å¦å¤–ï¼Œå¦‚æœå‘é€äº†å¤šå¼ å›¾ç‰‡ï¼Œä½†åªæœ‰ä¸€å¼ å›¾ç‰‡æŒ‡å®šäº† caption å‚æ•°ï¼Œé‚£ä¹ˆè¯¥ caption ä¼šå’Œå›¾ç‰‡ä¸€èµ·æ˜¾ç¤ºï¼Œæˆ‘ä»¬ä¸¾ä¾‹è¯´æ˜ã€‚

```python
async def send_media_group(update: Update,
                           context: ContextTypes.DEFAULT_TYPE):
    caption = "+v â¥(^_-) è§£é”åœ°çµæ®¿éšè—ç¦åˆ©"
    media_group = [
        # å¯ä»¥æ˜¯ URLã€bytes å¯¹è±¡ã€æ–‡ä»¶å¥æŸ„ã€file_id
        InputMediaPhoto(open('satori1.png', "rb")),
        InputMediaPhoto(open('satori2.png', "rb")),
        InputMediaPhoto(open('satori3.png', "rb"), caption=caption),
        InputMediaPhoto(open('satori4.png', "rb"))
    ]

    # å‘é€åª’ä½“ç»„
    await context.bot.send_media_group(
        chat_id=update.message.chat.id,
        media=media_group
    )
```

åªæœ‰ä¸€å¼ å›¾ç‰‡æŒ‡å®šäº† caption å‚æ•°ï¼Œæˆ‘ä»¬çœ‹çœ‹æ•ˆæœã€‚

![](./22.png)

æ­¤æ—¶å›¾ç‰‡ä¼šå’Œæ–‡å­—ä¸€èµ·æ˜¾ç¤ºï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥ä¸æŒ‡å®š caption å‚æ•°ï¼Œè€Œæ˜¯åœ¨å‘é€å®Œå›¾ç‰‡ä¹‹åï¼Œå†è°ƒç”¨ä¸€æ¬¡ send_messageã€‚è¿™ç§åšæ³•ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œåªä¸è¿‡æ­¤æ—¶å›¾ç‰‡å’Œæ–‡å­—ä¼šä½œä¸ºä¸¤æ¡æ¶ˆæ¯åˆ†å¼€æ˜¾ç¤ºã€‚

ä»¥ä¸Šæ˜¯å‘é€å›¾ç‰‡ï¼Œé™¤äº†å›¾ç‰‡ä¹‹å¤–è¿˜å¯ä»¥å‘é€éŸ³é¢‘ã€è§†é¢‘ã€æ–‡æ¡£ï¼Œå¹¶ä¸”åªæ”¯æŒè¿™ 4 ç§ã€‚ä½†è¦æ³¨æ„ï¼šå®ƒä»¬ä¸èƒ½æ··åœ¨ä¸€èµ·å‘ï¼Œåªæœ‰å›¾ç‰‡å’Œè§†é¢‘å¯ä»¥ï¼Œæˆ‘ä»¬æµ‹è¯•ä¸€ä¸‹ã€‚

```python
from telegram import (
    Update,
    InputMediaPhoto,
    InputMediaAudio,
    InputMediaVideo,
    InputMediaDocument
)
from telegram.ext import (
    ApplicationBuilder,
    ContextTypes,
    CommandHandler
)
from proxy import PROXY

BOT_API_TOKEN = "6485526535:AAEvGr9EDqtc4QPehkgohH6gczOTO5RIYRE"

async def send_media_group(update: Update,
                           context: ContextTypes.DEFAULT_TYPE):
    video_caption = (
        "è¿™æ¸¸æˆæˆ‘ç©ä¸ä¸‹å»äº†ï¼Œè£…å¤‡å–‚å…»å’Œè´´è†œå°±ç®—äº†ï¼Œ"
        "ä½†è‡ªå®šä¹‰è¯æ¡æˆ‘æ˜¯çœŸå¿ä¸äº†ï¼Œæ´—ä¸å‡ºæ¥ï¼Œæ ¹æœ¬æ´—ä¸å‡ºæ¥ã€‚"
    )
    media_group = [
        InputMediaPhoto(open("satori1.png", "rb")),
        InputMediaVideo(open("DNF è£…å¤‡é”€æ¯.mp4", "rb"), 
                        caption=video_caption),
        # ä¹Ÿæ”¯æŒå‘é€éŸ³é¢‘å’Œæ–‡æ¡£ï¼Œä½†ä¸èƒ½æ··åœ¨ä¸€èµ·
        # InputMediaAudio(open("3rd eye.mp3", "rb")),
        # InputMediaDocument(open('OpenAI.pdf', 'rb'))
    ]

    # å‘é€åª’ä½“ç»„
    await context.bot.send_media_group(
        chat_id=update.message.chat.id,
        media=media_group
    )

application = ApplicationBuilder().token(BOT_API_TOKEN).proxy(PROXY).build()
download_handler = CommandHandler("test_media_group", send_media_group)
application.add_handler(download_handler)
application.run_polling()
```

æµ‹è¯•ä¸€ä¸‹ï¼š

![](./23.png)

ç»“æœæ­£å¸¸ï¼Œåªæ˜¯å› ä¸ºè§†é¢‘å’Œå›¾ç‰‡æ˜¯ä¸€èµ·è¿”å›çš„ï¼Œæ‰€ä»¥æ²¡æœ‰é¢„è§ˆåŠŸèƒ½ï¼Œéœ€è¦ç‚¹å‡»ä¹‹åæ‰ä¼šæ’­æ”¾ã€‚å¹¶ä¸”æˆ‘ä»¬åªç»™è§†é¢‘æŒ‡å®šäº† caption å‚æ•°ï¼Œæ‰€ä»¥æ–‡å­—ç›´æ¥æ˜¾ç¤ºåœ¨äº†ä¸‹æ–¹ï¼Œå¦‚æœåª’ä½“ç»„ä¸­æœ‰å¤šä¸ª captionï¼Œé‚£ä¹ˆå°±ä¸ä¼šå•ç‹¬æ˜¾ç¤ºäº†ï¼Œéœ€è¦ç‚¹å‡»æ”¾å¤§ä¹‹åæ‰èƒ½çœ‹åˆ°ã€‚

å½“ç„¶å•¦ï¼Œå¦‚æœä½ ä¸éœ€è¦åŒæ—¶å‘é€å¤šä¸ªåª’ä½“æ–‡ä»¶ï¼Œé‚£ä¹ˆå°±æ²¡å¿…è¦è°ƒç”¨ send_media_group æ–¹æ³•äº†ï¼Œç›´æ¥ä½¿ç”¨ä¹‹å‰çš„æ–¹æ³•å³å¯ã€‚

- send_photoï¼›
- send_audioï¼›
- send_videoï¼›
- send_documentï¼›

è¿™äº›æ–¹æ³•ä¸€æ¬¡æ€§åªèƒ½å‘é€ä¸€ä¸ªåª’ä½“æ–‡ä»¶ï¼Œæ¯”å¦‚å‘é€è§†é¢‘ã€‚

~~~python
async def send_video(update: Update, context: ContextTypes.DEFAULT_TYPE):
    video_caption = (
        "è¿™æ¸¸æˆæˆ‘ç©ä¸ä¸‹å»äº†ï¼Œè£…å¤‡å–‚å…»å’Œè´´è†œå°±ç®—äº†ï¼Œ"
        "ä½†è‡ªå®šä¹‰è¯æ¡æˆ‘æ˜¯çœŸå¿ä¸äº†ï¼Œæ´—ä¸å‡ºæ¥ï¼Œæ ¹æœ¬æ´—ä¸å‡ºæ¥ã€‚"
    )
    await context.bot.send_video(
        chat_id=update.message.chat.id,
        video="DNF è£…å¤‡é”€æ¯.mp4",
        caption=video_caption,
        # è®© caption æ˜¾ç¤ºåœ¨ä¸Šæ–¹ï¼Œé»˜è®¤æ˜¾ç¤ºåœ¨ä¸‹æ–¹
        show_caption_above_media=True,
    )

application = ApplicationBuilder().token(BOT_API_TOKEN).proxy(PROXY).build()
download_handler = CommandHandler("destroy", send_video)
application.add_handler(download_handler)
application.run_polling()
~~~

æµ‹è¯•ä¸€ä¸‹ï¼š

![](./24.png)

æ€ä¹ˆæ ·ï¼Œæ˜¯ä¸æ˜¯å¾ˆæœ‰è¶£å‘¢ï¼Ÿå¦å¤– caption è¿˜å¯ä»¥æ˜¯å¯Œæ–‡æœ¬ï¼Œåªéœ€å°† parse_mode å‚æ•°æŒ‡å®šä¸º "HTML"ã€"Markdown" æˆ– "MarkdownV2" å³å¯ã€‚

å…³äºæœºå™¨äººå¦‚ä½•å›å¤ä¸åŒç§ç±»çš„æ¶ˆæ¯ï¼Œä»¥åŠåŒæ—¶å›å¤å¤šæ¡æ¶ˆæ¯ï¼Œç›¸å…³å†…å®¹æˆ‘ä»¬å°±è¯´å®Œäº†ã€‚æœ‰äº†è¿™äº›åŠŸèƒ½ï¼Œæˆ‘ä»¬çš„æœºå™¨äººå°±å·²ç»å¾ˆå¼ºå¤§äº†ï¼Œä½ ä¹Ÿå¯ä»¥æŠŠå®ƒå’Œå…¬å¸çš„ä¸šåŠ¡ç»“åˆèµ·æ¥ã€‚

æ¯”å¦‚åˆ›å»ºä¸€ä¸ªå‘½ä»¤ï¼š/getï¼Œå®ƒçš„åŠŸèƒ½å¦‚ä¸‹ã€‚

![](./25.png)

ç„¶ååœ¨ä»£ç ä¸­æ·»åŠ ä¸€ä¸ª `CommandHandler("get", get_table)`ï¼Œä¾¿å¯è®©ç”¨æˆ·é€šè¿‡ Telegram æŸ¥è¯¢æ•°æ®åº“è¡¨ï¼Œå½“ç„¶è¿™é‡Œåªæ˜¯æ‰“ä¸ªæ¯”æ–¹ï¼Œå…·ä½“æ€ä¹ˆåšå–å†³äºä½ çš„æƒ³æ³•ã€‚å¦å¤–å¤šè¯´ä¸€å¥ï¼Œå¦‚æœä½ å¸Œæœ›è¾“å…¥ / ä¹‹åèƒ½åƒä¸Šé¢é‚£æ ·æœ‰æç¤ºï¼Œé‚£ä¹ˆéœ€è¦é€šè¿‡ BotFather è¿›è¡Œè®¾ç½®ã€‚

![](./26.png)

è¦å¼ºè°ƒçš„æ˜¯ï¼Œè¿™ç§æ–¹å¼åªæ˜¯èµ·åˆ°ä¸€ä¸ªæç¤ºä½œç”¨ï¼Œæç¤ºæœºå™¨äººæ”¯æŒ /get å‘½ä»¤ã€‚ä½†æœºå™¨äººå®é™…ä¸Šæ˜¯å¦æ”¯æŒï¼Œå–å†³äºä»£ç ä¸­æ˜¯å¦ä¸ºæœºå™¨äººå®ç°äº† /getã€‚æ‰€ä»¥å½“æˆ‘ä»¬åœ¨ä»£ç ä¸­ä¸ºæœºå™¨äººæ·»åŠ å®Œå‘½ä»¤ä¹‹åï¼Œå¯ä»¥å†é€šè¿‡ Edit Commands è¿›è¡Œè®¾ç½®ï¼Œè¿™æ ·å½“ç”¨æˆ·è¾“å…¥ / ä¹‹åï¼Œæœºå™¨äººæœ‰å“ªäº›å‘½ä»¤ä»¥åŠæè¿°éƒ½ä¼šæ˜¾ç¤ºå‡ºæ¥ã€‚

å½“ç„¶å•¦ï¼Œå¦‚æœä½ ä¸é€šè¿‡ Edit Commands è¿›è¡Œè®¾ç½®çš„è¯ï¼Œä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œåªæ˜¯ç”¨æˆ·è¾“å…¥ / ä¹‹åä¸ä¼šæœ‰æç¤ºç½¢äº†ï¼Œä½†å‘½ä»¤æ˜¯ä¼šå›å¤çš„ï¼Œåªè¦åœ¨ä»£ç ä¸­å®ç°äº†ã€‚åŒç†ï¼Œå¦‚æœé€šè¿‡ Edit Commands è®¾ç½®äº†ï¼Œä½†ä»£ç ä¸­æ²¡å®ç°ï¼Œé‚£ä¹ˆè¯¥å‘½ä»¤ä¹Ÿä¸ä¼šæœ‰æ•ˆæœã€‚

## è‡ªå®šä¹‰æŒ‰é’®

è™½ç„¶ç›®å‰çš„æœºå™¨äººå·²ç»å¾ˆå¼ºå¤§äº†ï¼Œä½†æ˜¯è¿˜ä¸å¤Ÿï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹ BotFatherã€‚

![](./27.png)

ä½ ä¼šå‘ç°å®ƒä¸‹é¢å¸¦äº†å¾ˆå¤šçš„æŒ‰é’®ï¼Œç‚¹å‡»æŒ‰é’®ä¹‹åä¼šæ‰§è¡Œç›¸åº”çš„é€»è¾‘ï¼Œé‚£æˆ‘ä»¬è¦æ€ä¹ˆå®ç°è¿™äº›æŒ‰é’®å‘¢ï¼Ÿ

```python
from telegram import (
    Update,
    InlineKeyboardMarkup,
    InlineKeyboardButton,
)
from telegram.ext import (
    ApplicationBuilder,
    ContextTypes,
    CommandHandler
)
from proxy import PROXY

BOT_API_TOKEN = "6485526535:AAEvGr9EDqtc4QPehkgohH6gczOTO5RIYRE"

async def add_button(update: Update, context: ContextTypes.DEFAULT_TYPE):
    text = "ä½œä¸º<i>ç¨‹åºçŒ¿</i>ï¼Œä½ æœ€å–œæ¬¢å“ªç§ç¼–ç¨‹è¯­è¨€å‘¢ï¼Ÿ"
    # è®¾ç½®æŒ‰é’®
    reply_markup = InlineKeyboardMarkup([
        # ç¬¬ä¸€è¡Œ
        [InlineKeyboardButton(text="Python", url="https://www.python.org")],
        # ç¬¬äºŒè¡Œ
        [InlineKeyboardButton(text="Golang", url="https://golang.org")],
        # ç¬¬ä¸‰è¡Œ
        [InlineKeyboardButton(text="Rust", url="https://www.rust-lang.org")],
        # ç¬¬å››è¡Œ
        [InlineKeyboardButton(text="Zig", url="https://ziglang.org")],
    ])
    await context.bot.send_message(
        chat_id=update.message.chat.id,
        text=text,
        parse_mode="HTML",
        reply_markup=reply_markup
    )

application = ApplicationBuilder().token(BOT_API_TOKEN).proxy(PROXY).build()
download_handler = CommandHandler("language", add_button)
application.add_handler(download_handler)
application.run_polling()
```

æµ‹è¯•ä¸€ä¸‹ï¼š

![](./28.png)

æ­¤æ—¶æŒ‰é’®å°±å®ç°äº†ï¼Œç”±äºåœ¨ InlineKeyboardButton é‡Œé¢æŒ‡å®šçš„æ˜¯ urlï¼Œæ‰€ä»¥è¿™æ˜¯è·³è½¬æŒ‰é’®ï¼Œç‚¹å‡»ä¹‹åä¼šæ‰“å¼€æŒ‡å®šçš„é¡µé¢ã€‚å¹¶ä¸”æŒ‰é’®çš„å³ä¸Šè§’è¿˜æœ‰ä¸€ä¸ªå°ç®­å¤´ï¼Œè¡¨ç¤ºæŒ‰é’®æ˜¯è·³è½¬æŒ‰é’®ã€‚ä½†é™¤äº†è·³è½¬æŒ‰é’®ä¹‹å¤–ï¼Œè¿˜æœ‰å›è°ƒæŒ‰é’®ï¼Œä¹Ÿå°±æ˜¯ç‚¹å‡»æŒ‰é’®ä¹‹åä¼šæ‰§è¡Œå›è°ƒå‡½æ•°ï¼Œæˆ‘ä»¬ä¸¾ä¾‹è¯´æ˜ã€‚

~~~python
from telegram import (
    Update,
    InlineKeyboardMarkup,
    InlineKeyboardButton,
)
from telegram.ext import (
    ApplicationBuilder,
    ContextTypes,
    CommandHandler,
    CallbackQueryHandler,
)
from proxy import PROXY

BOT_API_TOKEN = "6485526535:AAEvGr9EDqtc4QPehkgohH6gczOTO5RIYRE"

async def add_button(update: Update, context: ContextTypes.DEFAULT_TYPE):
    text = "o(â•¥ï¹â•¥)oğŸ˜‚â•­(â•¯^â•°)â•®"
    # è®¾ç½®æŒ‰é’®
    reply_markup = InlineKeyboardMarkup([
        # ç¬¬ä¸€è¡Œï¼Œä¸¤ä¸ªè·³è½¬æŒ‰é’®
        [InlineKeyboardButton(text="ç™¾åº¦", url="https://www.baidu.com"),
         InlineKeyboardButton(text="è°·æ­Œ", url="https://www.google.com"),],
        # ç¬¬äºŒè¡Œï¼Œä¸¤ä¸ªå›è°ƒæŒ‰é’®
        [InlineKeyboardButton(text="æ²¹ç®¡", callback_data="youtube"),
         InlineKeyboardButton(text="Bç«™", callback_data="bilibili"),],
    ])
    await context.bot.send_message(
        chat_id=update.message.chat.id,
        text=text,
        reply_markup=reply_markup
    )

async def callback(update: Update, context: ContextTypes.DEFAULT_TYPE):
    # å½“ç‚¹å‡»å›è°ƒæŒ‰é’®æ—¶ï¼Œä¼šæ‰§è¡Œç›¸åº”çš„å›è°ƒå‡½æ•°
    cb_data = update.callback_query.data  # å›è°ƒæŒ‰é’®ä¸­æŒ‡å®šçš„ callback_data
    if cb_data == "youtube":
        text = "æ¬¢è¿æ¥åˆ°æ²¹ç®¡"
    elif cb_data == "bilibili":
        text = "æ¬¢è¿æ¥åˆ° B ç«™"
    else:
        text = "Unknown Website"
    await context.bot.send_message(
        # æ³¨æ„ï¼šè¿™é‡Œæ˜¯ update.callback_query.message.chat.id
        chat_id=update.callback_query.message.chat.id,
        text=text
    )

application = ApplicationBuilder().token(BOT_API_TOKEN).proxy(PROXY).build()
# æ·»åŠ  Handler
application.add_handler(
    CommandHandler("website", add_button)
)
# å¤„ç†å›è°ƒçš„ Handlerï¼Œå¦åˆ™ç‚¹å‡»æŒ‰é’®ä¸ä¼šæœ‰æ•ˆæœ
application.add_handler(
    CallbackQueryHandler(callback)
)
application.run_polling()
~~~

æµ‹è¯•ä¸€ä¸‹æ•ˆæœï¼š

![](./29.png)

ç‚¹å‡»æ²¹ç®¡å’Œ Bç«™çš„æ—¶å€™ä¼šæ‰§è¡Œå›è°ƒå‡½æ•°ï¼Œç»“æœæ²¡æœ‰é—®é¢˜ã€‚ä½†æ˜¯æˆ‘ä»¬å‘ç°ï¼Œè¿™äº›æ–‡å­—æ˜¯å•ç‹¬å‘é€çš„ï¼Œé‚£å¯ä¸å¯ä»¥æœ¬åœ°ä¿®æ”¹å‘¢ï¼Œä¹Ÿå°±æ˜¯å°†æŒ‰é’®ä¸Šæ–¹çš„æ–‡å­—æ›¿æ¢æ‰ã€‚ç­”æ¡ˆæ˜¯å¯ä»¥çš„ï¼Œæˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹ã€‚

~~~python
from telegram import (
    Update,
    InlineKeyboardMarkup,
    InlineKeyboardButton,
)
from telegram.ext import (
    ApplicationBuilder,
    ContextTypes,
    CommandHandler,
    CallbackQueryHandler,
)
from proxy import PROXY

BOT_API_TOKEN = "6485526535:AAEvGr9EDqtc4QPehkgohH6gczOTO5RIYRE"

def get_reply_markup():
    reply_markup = InlineKeyboardMarkup([
        [InlineKeyboardButton(text="å¤æ˜åœ°è§‰", callback_data="satori")],
        [InlineKeyboardButton(text="å¤æ˜åœ°æ‹", callback_data="koishi")],
        [InlineKeyboardButton(text="é›¾é›¨é­”ç†æ²™", callback_data="marisa")],
        [InlineKeyboardButton(text="çªéœ²è¯º", callback_data="cirno")],
    ])
    return reply_markup

async def add_button(update: Update, context: ContextTypes.DEFAULT_TYPE):
    text = "ç‚¹å‡»æƒ³è¦æ”»ç•¥çš„è§’è‰²"
    await context.bot.send_message(
        chat_id=update.message.chat.id,
        text=text,
        reply_markup=get_reply_markup()
    )

async def callback(update: Update, context: ContextTypes.DEFAULT_TYPE):
    cb_data = update.callback_query.data
    if cb_data == "satori":
        img = "ä½ å°†è¦æ”»ç•¥å¤æ˜åœ°è§‰"
    elif cb_data == "koishi":
        img = "ä½ å°†è¦æ”»ç•¥å¤æ˜åœ°æ‹"
    elif cb_data == "marisa":
        img = "ä½ å°†è¦æ”»ç•¥é›¾é›¨é­”ç†æ²™"
    elif cb_data == "cirno":
        img = "ä½ å°†è¦æ”»ç•¥çªéœ²è¯º"
    else:
        raise RuntimeError("Unreachable")
    # ç‚¹å‡»æŒ‰é’®ä¹‹åï¼Œè¦å¯¹ä¸Šæ–¹çš„æ–‡å­—è¿›è¡Œä¿®æ”¹ï¼Œæ›¿æ¢æˆå…¶å®ƒå†…å®¹
    # æ‰€ä»¥è¿™ç›¸å½“äºç¼–è¾‘å·²æœ‰æ¶ˆæ¯ï¼Œæ—¢ç„¶è¦ç¼–è¾‘ï¼Œé‚£ä¹ˆé™¤äº† chat_id ä¹‹å¤–è¿˜è¦æŒ‡å®š message_id
    # å› ä¸ºæ˜¯å›è°ƒï¼Œæ‰€ä»¥è¦å¤šè°ƒç”¨ä¸€æ¬¡ callback_query
    message_id = update.callback_query.message.message_id
    chat_id = update.callback_query.message.chat.id
    # è°ƒç”¨ edit_message_media æ–¹æ³•ï¼Œç¼–è¾‘æ¶ˆæ¯
    await context.bot.edit_message_text(
        text=img,
        chat_id=chat_id,
        message_id=message_id,
        reply_markup=get_reply_markup()
    )

application = ApplicationBuilder().token(BOT_API_TOKEN).proxy(PROXY).build()
application.add_handler(
    CommandHandler("gogogo", add_button)
)
application.add_handler(
    CallbackQueryHandler(callback)
)
application.run_polling()
~~~

æµ‹è¯•ä¸€ä¸‹ï¼š

![](./30.png)

ç„¶åç‚¹å‡»æŒ‰é’®ï¼Œçœ‹çœ‹æ–‡å­—å†…å®¹æœ‰æ²¡æœ‰å‘ç”Ÿæ”¹å˜ã€‚

![](./31.png)

ç‚¹å‡»æŒ‰é’®ï¼Œæ–‡å­—çš„å†…å®¹è¢«æ›¿æ¢äº†ã€‚æ‰€ä»¥å½“æœºå™¨äººå›å¤ä¸€æ¡æ¶ˆæ¯æ—¶ï¼Œåªéœ€çŸ¥é“ chat_id å³å¯ã€‚ä½†å¦‚æœæ˜¯ä¿®æ”¹æŸæ¡æ¶ˆæ¯ï¼Œé‚£ä¹ˆé™¤äº† chat_id ä¹‹å¤–ï¼Œè¿˜è¦çŸ¥é“ message_idã€‚

ä¿®æ”¹æ–‡å­—è°ƒç”¨çš„æ–¹æ³•æ˜¯ edit_message_textï¼Œä½†é™¤äº†ä¿®æ”¹æ–‡å­—ä¹‹å¤–ï¼Œè¿˜å¯ä»¥ä¿®æ”¹å…¶å®ƒå†…å®¹ã€‚

![](./32.png)

æ¯”å¦‚ä¿®æ”¹åª’ä½“æ–‡ä»¶ï¼Œä¿®æ”¹åª’ä½“æ–‡ä»¶çš„ captionï¼Œä¿®æ”¹æŒ‰é’®ç­‰ç­‰ã€‚

## ä¿®æ”¹æ¶ˆæ¯ç»¼åˆæ¡ˆä¾‹

å…³äºä¿®æ”¹æ¶ˆæ¯æˆ‘ä»¬å·²ç»çŸ¥é“æ€ä¹ˆåšäº†ï¼Œä¸‹é¢æ¥åšä¸€ä¸ªç»¼åˆæ¡ˆä¾‹ã€‚å‡è®¾å½“å‰æœ‰ N å¼ å›¾ç‰‡ï¼Œç”¨æˆ·é»˜è®¤ä¼šçœ‹åˆ°ç¬¬ä¸€å¼ ï¼Œç„¶åç‚¹å‡»æŒ‰é’®å¯ä»¥æŸ¥çœ‹ä¸‹ä¸€å¼ å›¾ç‰‡ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥æŸ¥çœ‹ä¸Šä¸€å¼ ã€‚é‚£ä¹ˆè¿™ä¸ªéœ€æ±‚æ€ä¹ˆå®ç°å‘¢ï¼Ÿ

```python
from telegram import (
    Update,
    InlineKeyboardMarkup,
    InlineKeyboardButton,
    InputMediaPhoto
)
from telegram.ext import (
    ApplicationBuilder,
    ContextTypes,
    CommandHandler,
    CallbackQueryHandler,
)
from proxy import PROXY

BOT_API_TOKEN = "6485526535:AAEvGr9EDqtc4QPehkgohH6gczOTO5RIYRE"
# è¿™é‡Œæˆ‘å°±ç”¨ 4 å¼ å›¾ç‰‡ä¸ºä¾‹
IMAGES = ["satori.png", "koishi.png", "marisa.png", "cirno.png"]

def get_navigation_buttons(index):
    reply_markup = InlineKeyboardMarkup([
        [InlineKeyboardButton(text="ä¸Šä¸€å¼ ", callback_data=f"prev:{index}"),
         InlineKeyboardButton(text="ä¸‹ä¸€å¼ ", callback_data=f"next:{index}")],
    ])
    return reply_markup

async def get_pic(update: Update, context: ContextTypes.DEFAULT_TYPE):
    # é»˜è®¤å‘é€ç¬¬ä¸€å¼ å›¾ç‰‡
    await context.bot.send_photo(
        chat_id=update.message.chat.id,
        photo=IMAGES[0],
        caption=f"æ­£åœ¨æµè§ˆç¬¬ 1 / {len(IMAGES)} å¼ å›¾ç‰‡",
        reply_markup=get_navigation_buttons(0)
    )

async def callback(update: Update, context: ContextTypes.DEFAULT_TYPE):
    # ç‚¹å‡»æŒ‰é’®ï¼Œè§¦å‘å›è°ƒ
    op, index = update.callback_query.data.split(":")
    if op == "prev":
        index = (int(index) - 1) % len(IMAGES)
    else:  # op == "next"
        index = (int(index) + 1) % len(IMAGES)
    # int(index) å‡ 1 å’ŒåŠ  1 ä¹‹åï¼Œå°±æ˜¯ä¸Šä¸€å¼ å›¾ç‰‡å’Œä¸‹ä¸€å¼ å›¾ç‰‡çš„ç´¢å¼•
    # ä½†è¿™é‡Œåˆå¯¹ len(IMAGES) è¿›è¡Œå–æ¨¡ï¼Œä¸»è¦æ˜¯ä¸ºäº†å®ç°å¾ªç¯æµè§ˆ
    # æ¯”å¦‚ç¬¬ä¸€å¼ çš„ä¸Šä¸€å¼ ä¼šè¿”å›æœ€åä¸€å¼ ï¼Œæœ€åä¸€å¼ çš„ä¸‹ä¸€å¼ ä¼šè¿”å›ç¬¬ä¸€å¼ 
    await context.bot.edit_message_media(
        chat_id=update.callback_query.message.chat.id,
        message_id=update.callback_query.message.message_id,
        media=InputMediaPhoto(
            open(IMAGES[index], "rb"),
            caption=f"æ­£åœ¨æµè§ˆç¬¬ {index + 1} / {len(IMAGES)} å¼ å›¾ç‰‡"
        ),
        reply_markup=get_navigation_buttons(index)
    )

application = ApplicationBuilder().token(BOT_API_TOKEN).proxy(PROXY).build()
application.add_handler(
    CommandHandler("get_pic", get_pic)
)
application.add_handler(
    CallbackQueryHandler(callback)
)
application.run_polling()
```

æµ‹è¯•ä¸€ä¸‹ï¼š

![](./33.png)

æ­¤æ—¶ç‚¹å‡»<font color="blue">æŒ‰é’®ä¸‹ä¸€å¼ </font>ï¼Œå°±ä¼šè¿”å›ä¸‹ä¸€å¼ å›¾ç‰‡ï¼ŒåŒç†ä¹Ÿå¯ä»¥è¿”å›ä¸Šä¸€å¼ å›¾ç‰‡ã€‚å¦‚æœå·²ç»æ˜¯æœ€åä¸€å¼ å›¾ç‰‡äº†ï¼Œé‚£ä¹ˆç‚¹å‡»ä¸‹ä¸€å¼ ï¼Œä¼šè¿”å›ç¬¬ä¸€å¼ å›¾ç‰‡ã€‚

ä½†é—®é¢˜æ¥äº†ï¼Œç¨‹åºè¦å¦‚ä½•å¾—çŸ¥ç”¨æˆ·æ­£åœ¨æµè§ˆçš„æ˜¯ç¬¬å‡ å¼ å›¾ç‰‡å‘¢ï¼Ÿæ˜¾ç„¶è¦å€ŸåŠ©äºæŒ‰é’®ã€‚åœ¨åˆ›å»ºæŒ‰é’®æ—¶ï¼Œå‚æ•° callback_data é‡Œé¢ä¿å­˜äº† indexï¼Œå½“ç‚¹å‡»ä¸‹ä¸€å¼ æˆ–ä¸Šä¸€å¼ æ—¶ï¼Œæ›´æ–° indexï¼Œè¿”å›æ–°çš„å›¾ç‰‡ï¼ŒåŒæ—¶åˆ·æ–°æŒ‰é’®ã€‚

ä»¥ä¸Šè¿”å›çš„æ˜¯å›¾ç‰‡ï¼Œä½ ä¹Ÿå¯ä»¥æ¢æˆè§†é¢‘ï¼Œå¹¶å¢åŠ ä¸€äº›ç‚¹èµã€æ˜¯å¦å–œæ¬¢ç­‰æŒ‰é’®ã€‚

## å°ç»“

ä»¥ä¸Šå°±æ˜¯ Python æ“ä½œ Telegram ç›¸å…³çš„å†…å®¹ï¼Œå½“ç„¶è¿™é‡Œåªä»‹ç»äº†ä¸€éƒ¨åˆ†ï¼Œè¿˜æœ‰ä¸€äº›æ›´å¤æ‚çš„åŠŸèƒ½æ²¡æœ‰è¯´ï¼Œæ¯”å¦‚æŒ‰é’®çš„åµŒå¥—ç­‰ç­‰ã€‚å¦å¤–ç›®å‰æ˜¯ç”¨æˆ·å’Œæœºå™¨äººä¸€å¯¹ä¸€ç§èŠï¼Œä½†æˆ‘ä»¬è¿˜å¯ä»¥åˆ›å»ºä¸€ä¸ªç»„ï¼Œè®©æœºå™¨äººå›å¤ç»„æˆå‘˜çš„æ¶ˆæ¯ã€‚è€Œå…³äºè¿™äº›å†…å®¹ï¼Œåç»­æœ‰ç©ºè¡¥ä¸Šï¼Œæœ¬æ–‡å°±å…ˆåˆ°è¿™å„¿ï¼Œå†™çš„æœ‰ç‚¹ç´¯äº†ã€‚