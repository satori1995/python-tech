<!DOCTYPE HTML>
<html lang="zh-cn" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>pyquery：一个灵活方便的 HTML 解析库 - Python 实用技巧</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../theme/custom.css">
        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../如何优雅地遍历可迭代对象？/doc.html">如何优雅地遍历可迭代对象？</a></li><li class="chapter-item expanded "><a href="../解密可迭代对象的排序问题/doc.html">解密可迭代对象的排序问题</a></li><li class="chapter-item expanded "><a href="../通过 TOP K 问题，探究堆和优先队列的秘密/doc.html">通过 TOP K 问题，探究堆和优先队列的秘密</a></li><li class="chapter-item expanded "><a href="../如何优雅地对数据进行分组？/doc.html">如何优雅地对数据进行分组？</a></li><li class="chapter-item expanded "><a href="../全方位解析 f-string/doc.html">全方位解析 f-string</a></li><li class="chapter-item expanded "><a href="../最好的日期处理库：pendulum/doc.html">最好的日期处理库：pendulum</a></li><li class="chapter-item expanded "><a href="../你知道创建模块都有哪些方式吗？/doc.html">你知道创建模块都有哪些方式吗？</a></li><li class="chapter-item expanded "><a href="../exit、quit、sys.exit、os._exit，这么多退出方式，它们之间有什么区别呢？/doc.html">exit、quit、sys.exit、os._exit，这么多退出方式，它们之间有什么区别呢？</a></li><li class="chapter-item expanded "><a href="../文件处理的一些最佳实践/doc.html">文件处理的一些最佳实践</a></li><li class="chapter-item expanded "><a href="../使用 os 模块更高效地读写文件/doc.html">使用 os 模块更高效地读写文件</a></li><li class="chapter-item expanded "><a href="../将文件映射到内存，像数组一样访问/doc.html">将文件映射到内存，像数组一样访问</a></li><li class="chapter-item expanded "><a href="../使用 psutil 获取硬件、网络以及进程信息/doc.html">使用 psutil 获取硬件、网络以及进程信息</a></li><li class="chapter-item expanded "><a href="../使用临时文件保存数据/doc.html">使用临时文件保存数据</a></li><li class="chapter-item expanded "><a href="../shutil：更优雅地拷贝文件/doc.html">shutil：更优雅地拷贝文件</a></li><li class="chapter-item expanded "><a href="../使用 contextvars 管理上下文变量/doc.html">使用 contextvars 管理上下文变量</a></li><li class="chapter-item expanded "><a href="../自定义异常堆栈信息/doc.html">自定义异常堆栈信息</a></li><li class="chapter-item expanded "><a href="../prettytable：像数据库一样格式化输出内容/doc.html">prettytable：像数据库一样格式化输出内容</a></li><li class="chapter-item expanded "><a href="../轻松绘制动态条形图/doc.html">轻松绘制动态条形图</a></li><li class="chapter-item expanded "><a href="../自定义 jupyter 魔法命令/doc.html">自定义 jupyter 魔法命令</a></li><li class="chapter-item expanded "><a href="../解析 ini、yaml、toml 配置文件/doc.html">解析 ini、yaml、toml 配置文件</a></li><li class="chapter-item expanded "><a href="../使用 fuzzywuzzy 模块计算两个字符串之间的相似度/doc.html">使用 fuzzywuzzy 模块计算两个字符串之间的相似度</a></li><li class="chapter-item expanded "><a href="../命令行解析工具 argparse/doc.html">命令行解析工具 argparse</a></li><li class="chapter-item expanded "><a href="../使用 urllib.parse 模块优雅地处理 URL/doc.html">使用 urllib.parse 模块优雅地处理 URL</a></li><li class="chapter-item expanded "><a href="../Python 实现复制粘贴/doc.html">Python 实现复制粘贴</a></li><li class="chapter-item expanded "><a href="../Python 生成、解析二维码/doc.html">Python 生成、解析二维码</a></li><li class="chapter-item expanded "><a href="../解密 __getattr__ 和 __getattribute__ 的用法与区别/doc.html">解密 __getattr__ 和 __getattribute__ 的用法与区别</a></li><li class="chapter-item expanded "><a href="../使用 fcntl 模块对文件进行加解锁/doc.html">使用 fcntl 模块对文件进行加解锁</a></li><li class="chapter-item expanded "><a href="../详解新一代 HTTP 请求库：httpx/doc.html">详解新一代 HTTP 请求库：httpx</a></li><li class="chapter-item expanded "><a href="../通过 contextlib 模块详细复习一下 with 语句的用法/doc.html">通过 contextlib 模块详细复习一下 with 语句的用法</a></li><li class="chapter-item expanded "><a href="../使用 collections 模块扩展你的数据类/doc.html">使用 collections 模块扩展你的数据类</a></li><li class="chapter-item expanded "><a href="../使用 unicodedata 模块对字符串标准化/doc.html">使用 unicodedata 模块对字符串标准化</a></li><li class="chapter-item expanded "><a href="../使用 struct 模块打包、解包二进制数据/doc.html">使用 struct 模块打包、解包二进制数据</a></li><li class="chapter-item expanded "><a href="../使用 watchfiles 模块监控目录变更/doc.html">使用 watchfiles 模块监控目录变更</a></li><li class="chapter-item expanded "><a href="../读取照片的 Exif 信息/doc.html">读取照片的 Exif 信息</a></li><li class="chapter-item expanded "><a href="../模拟 TLS 指纹实现反反爬/doc.html">模拟 TLS 指纹实现反反爬</a></li><li class="chapter-item expanded "><a href="../生成词云/doc.html">生成词云</a></li><li class="chapter-item expanded "><a href="../你知道 Python 其实自带了小型数据库吗/doc.html">你知道 Python 其实自带了小型数据库吗</a></li><li class="chapter-item expanded "><a href="../聊一聊 Python 的换行以及转义/doc.html">聊一聊 Python 的换行以及转义</a></li><li class="chapter-item expanded "><a href="../分享一个 Python 处理音频的库/doc.html">分享一个 Python 处理音频的库</a></li><li class="chapter-item expanded "><a href="../pyquery：一个灵活方便的 HTML 解析库/doc.html" class="active">pyquery：一个灵活方便的 HTML 解析库</a></li><li class="chapter-item expanded "><a href="../生成并识别图片验证码/doc.html">生成并识别图片验证码</a></li><li class="chapter-item expanded "><a href="../数据解压缩/doc.html">数据解压缩</a></li><li class="chapter-item expanded "><a href="../用 Python 操作你的鼠标和键盘/doc.html">用 Python 操作你的鼠标和键盘</a></li><li class="chapter-item expanded "><a href="../itertools：用于处理可迭代对象的模块/doc.html">itertools：用于处理可迭代对象的模块</a></li><li class="chapter-item expanded "><a href="../通过 atexit 模块让 Python 实现 Golang 的 defer 功能/doc.html">通过 atexit 模块让 Python 实现 Golang 的 defer 功能</a></li><li class="chapter-item expanded "><a href="../Python 实现 RSA 加密/doc.html">Python 实现 RSA 加密</a></li><li class="chapter-item expanded "><a href="../计算机是怎么存储整数的，原码、反码、补码又是个啥？/doc.html">计算机是怎么存储整数的，原码、反码、补码又是个啥？</a></li><li class="chapter-item expanded "><a href="../详解如何使用 Python 操作 Telegram（电报）机器人/doc.html">详解如何使用 Python 操作 Telegram（电报）机器人</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Python 实用技巧</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/satori1995/python-tech" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h2 id="楔子"><a class="header" href="#楔子">楔子</a></h2>
<p>在工作中难免会遇到解析 HTML 的场景，比如将网页下载下来之后，要解析出里面图片的路径、指定标签里的文本等等。而 pyquery 专门负责做这件事，它是仿照 jquery 设计的，用起来非常方便。并且 pyquery 底层基于 lxml，而 lxml 是使用 Cython 实现的，所以 pyquery 的速度也有保证。</p>
<pre><code class="language-python">from pyquery import PyQuery

html = &quot;&quot;&quot;
&lt;body&gt;
    &lt;p&gt;
        古明地觉的编程教室
    &lt;/p&gt;
&lt;/body&gt;
&quot;&quot;&quot;
p = PyQuery(html)
print(type(p))
&quot;&quot;&quot;
&lt;class 'pyquery.pyquery.PyQuery'&gt;
&quot;&quot;&quot;
# 打印 PyQuery 对象会直接显示 HTML 内容
print(p)
&quot;&quot;&quot;
&lt;body&gt;
    &lt;p&gt;
        古明地觉的编程教室
    &lt;/p&gt;
&lt;/body&gt;
&quot;&quot;&quot;
</code></pre>
<p>我们在获取 HTML 之后，直接传递 PyQuery 中，然后通过属性选择器即可获取指定的内容。</p>
<p>另外除了传递 HTML 文本之外，还可以传递一个 URL，或者 HTML 文件。</p>
<pre><code class="language-python">from pyquery import PyQuery

# 传递一个 url, 会自动调用 urlopen 下载内容
p1 = PyQuery(url=&quot;https://www.baidu.com&quot;, encoding=&quot;utf-8&quot;)
# 传递一个 html 文件, 会自动打开并读取
p2 = PyQuery(filename=&quot;1.html&quot;)
</code></pre>
<p>后两种方式其实不是很常用，我们一般还是会搭配 requests 或者 httpx，下载完页面之后直接丢给 PyQuery。</p>
<p>接下来我们看看如何筛选指定的标签，多说一句，我个人非常喜欢这个库，在解析 HTML 的时候首先想到的就是它。</p>
<h2 id="css-选择器"><a class="header" href="#css-选择器">CSS 选择器</a></h2>
<p>pyquery 是模仿 jquery 设计的，显然它也是通过类似于 CSS 选择器的方式进行筛选，下面介绍一些常用的选择器。</p>
<pre><code class="language-Python">from pyquery import PyQuery

html = &quot;&quot;&quot;
&lt;body&gt;
    &lt;div class=&quot;div_cls1 div_cls2&quot;&gt;
        &lt;p&gt;S 老师不想你们为了她两败俱伤&lt;/p&gt;
        &lt;p class=&quot;p_cls1&quot;&gt;高老师总能分享出好东西&lt;/p&gt;
        &lt;div class=&quot;div_cls3&quot;&gt;
            &lt;p id=&quot;six_six_six&quot;&gt;
                我也退了，都怪我说了不该说的
            &lt;/p&gt;
        &lt;/div&gt;
    &lt;/div&gt;

    &lt;div&gt;
        &lt;a href=&quot;http://www.me.org/bento/1.png&quot;&gt;&lt;/a&gt;
        &lt;p&gt;
            &lt;a href=&quot;http://www.me.org/image/2.png&quot;&gt;&lt;/a&gt;
        &lt;/p&gt;
    &lt;/div&gt;

    &lt;div class=&quot;div_cls1&quot;&gt;
        &lt;span&gt;嘿嘿嘿&lt;/span&gt;
    &lt;/div&gt;
&lt;/body&gt;
&quot;&quot;&quot;
p = PyQuery(html)
</code></pre>
<p>我们以上面这个 HTML 为例，来看看相关操作。</p>
<p><font color="blue"><strong>基于标签进行选择</strong></font></p>
<pre><code class="language-Python"># 选择所有的 p 标签
print(p(&quot;p&quot;))
&quot;&quot;&quot;
&lt;p&gt;S 老师不想你们为了她两败俱伤&lt;/p&gt;
        &lt;p class=&quot;p_cls1&quot;&gt;高老师总能分享出好东西&lt;/p&gt;
        &lt;p id=&quot;six_six_six&quot;&gt;
                我也退了，都怪我说了不该说的
            &lt;/p&gt;
        &lt;p&gt;
            &lt;a href=&quot;http://www.me.org/image/2.png&quot;/&gt;
        &lt;/p&gt;
    
&quot;&quot;&quot;
</code></pre>
<p>会选择所有指定的标签，并且包含标签里面的内容。</p>
<p><font color="blue"><strong>同时选择多个标签</strong></font></p>
<p>在基于标签选择时，也可以同时选择多个标签。</p>
<pre><code class="language-Python"># 选择所有的 p 标签和 a 标签
print(p(&quot;p,a&quot;))
&quot;&quot;&quot;
&lt;p&gt;S 老师不想你们为了她两败俱伤&lt;/p&gt;
        &lt;p class=&quot;p_cls1&quot;&gt;高老师总能分享出好东西&lt;/p&gt;
        &lt;p id=&quot;six_six_six&quot;&gt;
                我也退了，都怪我说了不该说的
            &lt;/p&gt;
        &lt;a href=&quot;http://www.me.org/bento/1.png&quot;/&gt;
        &lt;p&gt;
            &lt;a href=&quot;http://www.me.org/image/2.png&quot;/&gt;
        &lt;/p&gt;
    &lt;a href=&quot;http://www.me.org/image/2.png&quot;/&gt;
    
&quot;&quot;&quot;
</code></pre>
<p>多个标签之间使用逗号分隔，会将多个标签都筛选出来。</p>
<p>注意：筛选的标签之间是独立的，比如第二个 a 标签，它在 p 标签里面。我们筛选 p 标签的时候，已经将它内部的 a 标签筛选出来了，但在筛选 a 标签的时候又筛选出来一次，因此标签之间是独立的。</p>
<p><font color="blue"><strong>选择指定标签下的子标签</strong></font></p>
<pre><code class="language-Python"># 选择所有的 div 标签下的所有 a 标签
print(p(&quot;div a&quot;))
&quot;&quot;&quot;
&lt;a href=&quot;http://www.me.org/bento/1.png&quot;/&gt;
        &lt;a href=&quot;http://www.me.org/image/2.png&quot;/&gt;
        
&quot;&quot;&quot;
</code></pre>
<p>多个标签使用空格分隔，表示筛选层级，比如 tag1 tag2 tag3，表示筛选所有 tag1 标签下的所有 tag2 标签下的所有 tag3 标签。</p>
<p>div a 表示从所有 div 的子孙节点中选择 a 标签，如果只希望从儿子节点中选择呢？</p>
<pre><code class="language-Python"># 选择所有的 div 标签下的所有 a 标签，但只从儿子节点中选择
# 第二个 a 标签的外部套了个 p 标签，所以不符合筛选条件
print(p(&quot;div&gt;a&quot;))
&quot;&quot;&quot;
&lt;a href=&quot;http://www.me.org/bento/1.png&quot;/&gt;
        
&quot;&quot;&quot;
</code></pre>
<p>当标签之间是空格，那么会从子孙节点当中选择；当标签之间是大于号，那么只会从儿子节点当中选择。</p>
<p><font color="blue"><strong>按照 id 选择标签</strong></font></p>
<pre><code class="language-Python"># 选择 id = &quot;six_six_six&quot; 的标签
print(p(&quot;#six_six_six&quot;))
&quot;&quot;&quot;
&lt;p id=&quot;six_six_six&quot;&gt;
                我也退了，都怪我说了不该说的
            &lt;/p&gt;
&quot;&quot;&quot;
</code></pre>
<p>id 在一个 html 中具有唯一性，所以有 id 属性的话，那么会非常好定位。</p>
<p><font color="blue"><strong>按照 class 选择标签</strong></font></p>
<pre><code class="language-Python">p = PyQuery(html)
# 选择 class 等于 &quot;p_cls1&quot; 的标签
print(p(&quot;.p_cls1&quot;))
&quot;&quot;&quot;
&lt;p class=&quot;p_cls1&quot;&gt;高老师总能分享出好东西&lt;/p&gt;
&quot;&quot;&quot;
</code></pre>
<p>选择所有 class 属性等于 p_cls1 的标签，但是注意，一个标签可以同时拥有多个 class。</p>
<pre><code class="language-Python">print(p(&quot;.div_cls1&quot;))
&quot;&quot;&quot;
&lt;div class=&quot;div_cls1 div_cls2&quot;&gt;
        &lt;p&gt;S 老师不想你们为了她两败俱伤&lt;/p&gt;
        &lt;p class=&quot;p_cls1&quot;&gt;高老师总能分享出好东西&lt;/p&gt;
        &lt;div class=&quot;div_cls3&quot;&gt;
            &lt;p id=&quot;six_six_six&quot;&gt;
                我也退了，都怪我说了不该说的
            &lt;/p&gt;
        &lt;/div&gt;
    &lt;/div&gt;

    &lt;div class=&quot;div_cls1&quot;&gt;
        &lt;span&gt;嘿嘿嘿&lt;/span&gt;
    &lt;/div&gt;
        
&quot;&quot;&quot;
</code></pre>
<p>我们看到两个 div 都应用了 div_cls1 这个 class，因此它们都被筛选了出来。而第一个 div 除了 div_cls1，还应用了 div_cls2 这个 class。</p>
<p>那么问题来了，如果我们希望选择同时应用了 div_cls1 和 div_cls2 的标签该怎么做呢？</p>
<pre><code class="language-Python">print(p(&quot;.div_cls1.div_cls2&quot;))
&quot;&quot;&quot;
&lt;div class=&quot;div_cls1 div_cls2&quot;&gt;
        &lt;p&gt;S 老师不想你们为了她两败俱伤&lt;/p&gt;
        &lt;p class=&quot;p_cls1&quot;&gt;高老师总能分享出好东西&lt;/p&gt;
        &lt;div class=&quot;div_cls3&quot;&gt;
            &lt;p id=&quot;six_six_six&quot;&gt;
                我也退了，都怪我说了不该说的
            &lt;/p&gt;
        &lt;/div&gt;
    &lt;/div&gt;
        
&quot;&quot;&quot;
</code></pre>
<p>我们看到此时就只获取了第一个 div，注意：.div_cls1 和 .div_cls2 之间不可以有空格，如果加上了空格，那么含义就变成了选择 .div_cls1 标签下面的 .div_cls2 标签。</p>
<p>所以 id、class、标签等选择器，它们可以搭配使用。比如说：</p>
<p><img src="./1.png" alt="" /></p>
<p>实际举例说明：</p>
<pre><code class="language-python"># 找到所有 class 包含 div_cls1、div_cls2 的标签
# 再从其儿子节点中找到所有 class 包含 .div_cls3 的 div 标签
print(p(&quot;div.div_cls1.div_cls2&gt;div.div_cls3&quot;))
&quot;&quot;&quot;
&lt;div class=&quot;div_cls3&quot;&gt;
            &lt;p id=&quot;six_six_six&quot;&gt;
                我也退了，都怪我说了不该说的
            &lt;/p&gt;
        &lt;/div&gt;
        
&quot;&quot;&quot;
</code></pre>
<p>综上所述，pyquery 还是很强大的。</p>
<p><font color="blue"><strong>选择是否具有指定属性的标签</strong></font></p>
<pre><code class="language-python"># 选择具有 class 属性的 p 标签
print(p(&quot;p[class]&quot;))
&quot;&quot;&quot;
&lt;p class=&quot;p_cls1&quot;&gt;高老师总能分享出好东西&lt;/p&gt;
&quot;&quot;&quot;

# 选择具有 id 属性的 p 标签
print(p(&quot;p[id]&quot;))
&quot;&quot;&quot;
&lt;p id=&quot;six_six_six&quot;&gt;
                我也退了，都怪我说了不该说的
            &lt;/p&gt;
&quot;&quot;&quot;

# 选择 class=&quot;div_cls1&quot; 的 div 标签
# 等号右面可以是双引号，也可以是单引号，也可以不加引号
print(p(&quot;div[class='div_cls1']&quot;))
&quot;&quot;&quot;
&lt;div class=&quot;div_cls1&quot;&gt;
        &lt;span&gt;嘿嘿嘿&lt;/span&gt;
    &lt;/div&gt;
&quot;&quot;&quot;
# 注意：div[class='div_cls1'] 和 div.div_cls1 不同
# 前者要求 class 属性必须为 div_cls1
# 而后者要求 class 属性只要包含 div_cls1 即可


# 这些属性除了 id、class 之外, 也可以是其它的任意属性（随便写一个也可以）
# 下面选择所有具有 href 属性的 a 标签
print(p(&quot;a[href]&quot;))
&quot;&quot;&quot;
&lt;a href=&quot;http://www.me.org/bento/1.png&quot;/&gt;
        &lt;a href=&quot;http://www.me.org/image/2.png&quot;/&gt;
&quot;&quot;&quot;

# 选择 href 等于某个 url 的 a 标签, 这里的 url 必须要使用引号包起来
print(p(&quot;a[href='http://www.me.org/bento/1.png']&quot;))
&quot;&quot;&quot;
&lt;a href=&quot;http://www.me.org/bento/1.png&quot;/&gt;
&quot;&quot;&quot;

# 还可以指定以 ... 开头
print(p(&quot;a[href^='http://www.me.org/image']&quot;))
&quot;&quot;&quot;
&lt;a href=&quot;http://www.me.org/image/2.png&quot;/&gt;
&quot;&quot;&quot;

# 指定以 ... 结尾
print(p(&quot;a[href$='2.png']&quot;))
&quot;&quot;&quot;
&lt;a href=&quot;http://www.me.org/image/2.png&quot;/&gt;
&quot;&quot;&quot;

# 包含 ...
print(p(&quot;a[href*='bento']&quot;))
&quot;&quot;&quot;
&lt;a href=&quot;http://www.me.org/bento/1.png&quot;/&gt;
&quot;&quot;&quot;
# 当然其它属性也可以，选择 class 包含 div_cls1 的 a 标签
# 此时 div[class*='div_cls1'] 和 div.div_cls1 是等价的
print(p(&quot;div[class*='div_cls1']&quot;) == p(&quot;div.div_cls1&quot;))
&quot;&quot;&quot;
True
&quot;&quot;&quot;
</code></pre>
<p><font color="blue"><strong>选择指定位置的标签</strong></font></p>
<pre><code class="language-python"># 先选择所有 class 包含 div_cls1、div_cls2 的标签
# 然后从它的儿子节点中选择所有的 p 标签
print(p(&quot;.div_cls1.div_cls2&gt;p&quot;))
&quot;&quot;&quot;
&lt;p&gt;S 老师不想你们为了她两败俱伤&lt;/p&gt;
        &lt;p class=&quot;p_cls1&quot;&gt;高老师总能分享出好东西&lt;/p&gt;
&quot;&quot;&quot;
# 先选择所有 class 包含 div_cls1、div_cls2 的标签
# 然后从它的儿子节点中选择所有 class 等于 p_cls1 的 p 标签
print(p(&quot;.div_cls1.div_cls2&gt;p[class='p_cls1']&quot;))
&quot;&quot;&quot;
&lt;p class=&quot;p_cls1&quot;&gt;高老师总能分享出好东西&lt;/p&gt;
&quot;&quot;&quot;

# 然后也可以按照位置进行选择，比如这里选择符合条件的第一个 p 标签
print(p(&quot;.div_cls1.div_cls2&gt;p:nth-child(1)&quot;))
&quot;&quot;&quot;
&lt;p&gt;S 老师不想你们为了她两败俱伤&lt;/p&gt;
&quot;&quot;&quot;
# 选择符合条件的第二个 p 标签
print(p(&quot;.div_cls1.div_cls2&gt;p:nth-child(2)&quot;))
&quot;&quot;&quot;
&lt;p class=&quot;p_cls1&quot;&gt;高老师总能分享出好东西&lt;/p&gt;
&quot;&quot;&quot;
</code></pre>
<p><font color="blue"><strong>选择兄弟标签</strong></font></p>
<pre><code class="language-python"># 选择 class 包含 p_cls1 的所有 p 标签，然后选择它的兄弟标签
print(p(&quot;p.p_cls1&quot;).siblings())
&quot;&quot;&quot;
&lt;p&gt;S 老师不想你们为了她两败俱伤&lt;/p&gt;
        &lt;div class=&quot;div_cls3&quot;&gt;
            &lt;p id=&quot;six_six_six&quot;&gt;
                我也退了，都怪我说了不该说的
            &lt;/p&gt;
        &lt;/div&gt;
&quot;&quot;&quot;
</code></pre>
<p>以上就是一些常见的 CSS 选择器，在工作中一般是够用了。</p>
<h2 id="获取标签属性"><a class="header" href="#获取标签属性">获取标签属性</a></h2>
<p>基于 CSS 选择器，我们可以拿到指定的标签，然后就是获取属性了，比如获取文本。</p>
<pre><code class="language-python">print(p(&quot;p&quot;).text())
&quot;&quot;&quot;
S 老师不想你们为了她两败俱伤 高老师总能分享出好东西 我也退了，都怪我说了不该说的
&quot;&quot;&quot;
</code></pre>
<p>返回的是字符串，里面包含了所有的 p 标签里的文本。但这样我们就不知道，哪个文本是哪个 p 标签里面的了，因此我们可以进行遍历。</p>
<p>PyQuery 这个类继承 list，因为基于选择器筛选到的标签可能会有多个，因此提供了用于遍历的方法。但遍历得到依旧是 PyQuery 对象，只不过此时里面就只有一个标签了。</p>
<pre><code class="language-python"># 可以对选择的标签进行遍历
for tag in p(&quot;p&quot;).items():
    print(tag.text())
&quot;&quot;&quot;
S 老师不想你们为了她两败俱伤
高老师总能分享出好东西
我也退了，都怪我说了不该说的
&quot;&quot;&quot;
</code></pre>
<p>text 方法用于获取文本，至于其它属性则通过 attr 方法获取。</p>
<pre><code class="language-python">for tag in p(&quot;a&quot;).items():
    print(tag.attr(&quot;href&quot;))
&quot;&quot;&quot;
http://www.me.org/bento/1.png
http://www.me.org/image/2.png
&quot;&quot;&quot;

for tag in p(&quot;div&quot;).items():
    print(tag.attr(&quot;class&quot;))
&quot;&quot;&quot;
div_cls1 div_cls2
div_cls3
None
div_cls1
&quot;&quot;&quot;

# 遍历所有的标签，获取 id 的值
for tag in p(&quot;*&quot;).items():
    if tag.attr(&quot;id&quot;) is not None:
        print(tag.attr(&quot;id&quot;))
&quot;&quot;&quot;
six_six_six
&quot;&quot;&quot;

# 通过 attr 可以获取所有的属性，甚至自定义的也可以
</code></pre>
<p>是不是很方便呢？基于 CSS 选择器和 attr 方法，我们就能获取所有想要的属性。</p>
<h2 id="find-和-filter"><a class="header" href="#find-和-filter">find 和 filter</a></h2>
<p>PyQuery 对象还有两个很重要的方法，分别是 find 和 filter。</p>
<p>先来看看 find：</p>
<pre><code class="language-python"># p(&quot;div .div_cls3 p&quot;) 等价于 p.find(&quot;div&quot;).find(&quot;.div_cls3&quot;).find(&quot;p&quot;)
# 或者也等价于 p.find(&quot;div&quot;).find(&quot;.div_cls3 p&quot;)
# 也等价于 p.find(&quot;div .div_cls3&quot;).find(&quot;p&quot;)
print(p(&quot;div .div_cls3 p&quot;) ==
      p.find(&quot;div&quot;).find(&quot;.div_cls3&quot;).find(&quot;p&quot;) ==
      p.find(&quot;div&quot;).find(&quot;.div_cls3 p&quot;) ==
      p.find(&quot;div .div_cls3&quot;).find(&quot;p&quot;))
&quot;&quot;&quot;
True
&quot;&quot;&quot;

# 相信你应该明白 find 方法是做什么的了，它是基于指定条件继续向内筛选
# 比如我们成功筛选了指定的标签
tag = p(&quot;div .div_cls3&quot;)
# 这时候想在 tag 的基础上继续获取它内部的 p 标签，那么可以调用 find
print(tag.find(&quot;p&quot;))
&quot;&quot;&quot;
&lt;p id=&quot;six_six_six&quot;&gt;
                我也退了，都怪我说了不该说的
            &lt;/p&gt;
&quot;&quot;&quot;
</code></pre>
<p>tag.find 是在 tag 的基础上继续向内筛选，而 tag.filter 则是对 tag 进行过滤。</p>
<pre><code class="language-python">tag = p(&quot;div p&quot;)
# 在 tag 的基础上向内筛选，获取 class 包含 p_cls1 的标签
# 但 div p 内部没有 class 包含 p_cls1 的标签
print(tag.find(&quot;.p_cls1&quot;))
&quot;&quot;&quot;
&quot;&quot;&quot;
# 对 tag 进行过滤，从已获取的 tag 中过滤出 class 包含 p_cls1 的标签
print(tag.filter(&quot;.p_cls1&quot;))
&quot;&quot;&quot;
&lt;p class=&quot;p_cls1&quot;&gt;高老师总能分享出好东西&lt;/p&gt;
&quot;&quot;&quot;
</code></pre>
<p>所以当你筛选了指定的 div 之后，你想从它的内部继续筛选，那么就使用 find 方法。如果你想按照指定条件对 div 进行过滤，那么就使用 filter。</p>
<p>另外 filter 还有一个用法，就是可以根据文本进行过滤。</p>
<pre><code class="language-python">print(p(&quot;p&quot;))
&quot;&quot;&quot;
&lt;p&gt;S 老师不想你们为了她两败俱伤&lt;/p&gt;
        &lt;p class=&quot;p_cls1&quot;&gt;高老师总能分享出好东西&lt;/p&gt;
        &lt;p id=&quot;six_six_six&quot;&gt;
                我也退了，都怪我说了不该说的
            &lt;/p&gt;
        &lt;p&gt;
            &lt;a href=&quot;http://www.me.org/image/2.png&quot;/&gt;
        &lt;/p&gt;
&quot;&quot;&quot;
# 对筛选到 p 标签进行过滤，只保留文本包含 &quot;老师&quot; 的 p 标签
print(
    p(&quot;p&quot;).filter(lambda _, this: &quot;老师&quot; in PyQuery(this).text())
)
&quot;&quot;&quot;
&lt;p&gt;S 老师不想你们为了她两败俱伤&lt;/p&gt;
        &lt;p class=&quot;p_cls1&quot;&gt;高老师总能分享出好东西&lt;/p&gt;
&quot;&quot;&quot;
</code></pre>
<p>以上就是 find 和 filter 的用法，当你的解析需求不复杂时，直接调用 PyQuery 对象即可，否则可以搭配这两个方法。</p>
<h2 id="小结"><a class="header" href="#小结">小结</a></h2>
<p>总的来说，pyquery 还是相当方便的，相比 bs4 多了更多的灵活性，而且速度也更快一些。</p>
<p>当然 pyquery 还有一些功能我们没有说，比如追加节点等等，但这些不常用，所以不再赘述。因为我们只是解析 HTML，能基于选择器获取想要的标签以及属性就足够了。</p>
<p>虽然 pyquery 是仿照 jquery 设计的，但我们不会像 jquery 操作 DOM 那样，对节点进行新增修改啥的。我们要做的只有查询，基于选择器获取指定标签，并且选择器也不止我们上面介绍的那些，不过基本上够用了。</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../分享一个 Python 处理音频的库/doc.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../生成并识别图片验证码/doc.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../分享一个 Python 处理音频的库/doc.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../生成并识别图片验证码/doc.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript" src="../theme/custom.js"></script>
    </body>
</html>
